---
status: ready-for-dev
priority: medium
estimate: S
story_id: "2.2"
epic: "Epic 2 - Gestione Anagrafiche"
---

# Story 2.2: Lista e Ricerca Clienti

**As a** Commerciale, **I want** to search and filter customers, **so that** I can quickly find customer information.

## Acceptance Criteria

### AC-1
**Given** esistono 25 clienti nel sistema con codici cliente valorizzati e ordinamento deterministico per id crescente
**When** invio GET /api/clienti?page=1&limit=10
**Then** ricevo 200 con body contenente data di 10 clienti e meta { page: 1, limit: 10, total: 25, totalPages: 3 }
Source: Derived from epic-details AC-1

### AC-2
**Given** esistono clienti con valore Rossi nel campo 
ome o nel campo codiceCliente
**When** invio GET /api/clienti?search=Rossi
**Then** ricevo solo clienti che matchano Rossi su 
ome o codiceCliente
Source: Derived from epic-details AC-2

### AC-3
**Given** esistono clienti con 	ipologia=PRIVATO e clienti con 	ipologia=AZIENDA
**When** invio GET /api/clienti?tipologia=AZIENDA
**Then** ricevo solo clienti con 	ipologia uguale a AZIENDA
Source: Derived from epic-details AC-3

## Target Modules

- packages/backend/src/routes/clienti.ts
- packages/backend/src/services/anagrafiche-service.ts
- packages/backend/src/__tests__/clienti-create-atdd.spec.ts
- packages/backend/src/__tests__/audit-trail.spec.ts
- packages/backend/src/index.ts

## Task Breakdown

- [ ] Task 1 (AC-1, AC-2, AC-3): aggiornare packages/backend/src/routes/clienti.ts per supportare GET /api/clienti con parsing query (page, limit, search, 	ipologia) e delega al service.
- [ ] Task 2 (AC-1): implementare in packages/backend/src/services/anagrafiche-service.ts la lista clienti paginata con risposta { data, meta } e calcolo 	otalPages.
- [ ] Task 3 (AC-2): implementare in packages/backend/src/services/anagrafiche-service.ts filtro di ricerca case-insensitive su 
ome e codiceCliente.
- [ ] Task 4 (AC-3): implementare in packages/backend/src/services/anagrafiche-service.ts filtro su 	ipologia con valore AZIENDA.
- [ ] Task 5 (AC-1, AC-2, AC-3): estendere packages/backend/src/__tests__/clienti-create-atdd.spec.ts con scenari lista/ricerca/filtro e assert su payload data + meta.
- [ ] Task 6 (AC-1): riusare pattern di assert paginazione in packages/backend/src/__tests__/audit-trail.spec.ts per verifiche su meta.total, meta.totalPages e lunghezza data.

## Implementation Notes

- AC e dettagli funzionali derivano da docs/epics/epic-2-anagrafiche.md (Story 2.2).
- Pattern da seguire: parsing query in route (packages/backend/src/routes/audit-log.ts:37) e paginazione service (packages/backend/src/services/anagrafiche-service.ts:632, packages/backend/src/services/anagrafiche-service.ts:1012).
