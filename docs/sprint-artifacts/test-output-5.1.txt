
> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present --run

npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32mâœ“[39m src/__tests__/preventivi-detail-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 68[2mms[22m[39m
 [32mâœ“[39m src/__tests__/preventivi-send-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 181[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fornitori-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 221[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 244[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 256[2mms[22m[39m
 [31mâ¯[39m src/__tests__/articoli-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 295[2mms[22m[39m
[31m   [31mÃ—[31m AC-1 - Creazione articolo con giacenza iniziale[2m > [22mTests AC-1: Given ADMIN and full payload When POST /api/articoli Then 201[39m[32m 71[2mms[22m[39m
[31m     â†’ expected 404 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-1 - Creazione articolo con giacenza iniziale[2m > [22mTests AC-1: Given successful creation When reading response Then codiceArticolo and giacenza are expected[39m[32m 13[2mms[22m[39m
[31m     â†’ expected 404 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Duplicato codice articolo[2m > [22mTests AC-2: Given existing codiceArticolo When POST duplicate Then 409 CODICE_ARTICOLO_EXISTS[39m[32m 42[2mms[22m[39m
[31m     â†’ expected 404 to be 409 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Duplicato codice articolo[2m > [22mTests AC-2: Given duplicate create When API rejects Then message is explicit and id is absent[39m[32m 21[2mms[22m[39m
[31m     â†’ expected 404 to be 409 // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Validazione prezzi[2m > [22mTests AC-3: Given prezzoVendita lower than prezzoAcquisto When POST /api/articoli Then 400 VALIDATION_ERROR[39m[32m 31[2mms[22m[39m
[31m     â†’ expected 404 to be 400 // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Validazione prezzi[2m > [22mTests AC-3: Given invalid price relation When validation fails Then field and message are deterministic[39m[32m 31[2mms[22m[39m
[31m     â†’ expected 404 to be 400 // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Tecnico non autorizzato[2m > [22mTests AC-4: Given TECNICO When POST /api/articoli Then 403 FORBIDDEN[39m[32m 21[2mms[22m[39m
[31m     â†’ expected 404 to be 403 // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Tecnico non autorizzato[2m > [22mTests AC-4: Given TECNICO forbidden response When checking payload Then message is Accesso negato[39m[32m 31[2mms[22m[39m
[31m     â†’ expected 404 to be 403 // Object.is equality[39m
[31m   [31mÃ—[31m AC-5 - Fornitore inesistente[2m > [22mTests AC-5: Given ADMIN and missing fornitoreId When POST /api/articoli Then 404 FORNITORE_NOT_FOUND[39m[32m 24[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'code')[39m
   [32mâœ“[39m AC-5 - Fornitore inesistente[2m > [22mTests AC-5: Given missing supplier When creation fails Then no created id is exposed[32m 8[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 336[2mms[22m[39m
 [32mâœ“[39m src/__tests__/preventivi-response-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 344[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 350[2mms[22m[39m
 [32mâœ“[39m src/__tests__/preventivi-update-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 355[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 360[2mms[22m[39m
 [32mâœ“[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 516[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 591[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return 200 with 15 fornitori and meta {page:1,limit:20,total:15,totalPages:1} [33m 337[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 623[2mms[22m[39m
 [32mâœ“[39m src/__tests__/preventivi-create-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 805[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Creazione preventivo con totali[2m > [22mTests AC-1: Given esiste una riparazione con id=10 When invio POST /api/preventivi con payload MANODOPERA+RICAMBIO Then viene creato preventivo in stato "BOZZA" con subtotale=200.00, iva=44.00, totale=244.00 e HTTP 201 [33m 338[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 914[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Lista clienti paginata[2m > [22mtests AC-1: should return 200 with data[10] and meta {page:1,limit:10,total:25,totalPages:3} [33m 540[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-detail-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1008[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then I receive 200 with full riparazione data including cliente { id, nome, telefono, email }, tecnico { id, username }, current stato [33m 342[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1066[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 539[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns user payload with id, username, email and role [33m 449[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-list-filter-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1080[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Lista riparazioni paginata[2m > [22mtests AC-1: Given 30 repairs exist When GET /api/riparazioni?page=1&limit=15 Then returns 200 with 15 rows and meta {page:1,limit:15,total:30,totalPages:2} [33m 675[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1108[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 907[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fatture-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1281[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo id=5 APPROVATO con totale 244.00 When POST /api/fatture { riparazioneId: 10 } Then HTTP 201 con numeroFattura 2026/0001 e importi 200/44/244 [33m 380[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-annullamento-admin-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1327[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Admin annulla da IN_LAVORAZIONE con nota[2m > [22mTests AC-1: Given ADMIN userId=1 and riparazione 10 in stato IN_LAVORAZIONE When PATCH /api/riparazioni/10/stato {"stato":"ANNULLATA","note":"Cliente ha ritirato dispositivo"} Then 200 with data.stato ANNULLATA [33m 451[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-assegnazione-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1611[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Assegnazione valida a tecnico[2m > [22mTests AC-1: Given admin and user id=7 role TECNICO When PATCH /api/riparazioni/10/assegna {tecnicoId:7} Then 200 and data.id=10 data.tecnicoId=7 [33m 470[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1725[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 495[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Login Utente valido[2m > [22mreturns user payload with id, username, email, role [33m 446[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-3 - Account disabilitato[2m > [22mreturns 401 ACCOUNT_DISABLED for mario.disabilitato [33m 407[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-3 - Account disabilitato[2m > [22mreturns no tokens for disabled account [33m 314[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fatture-pagamenti-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1795[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Registrazione pagamento totale[2m > [22mTests AC-1: Given fattura id=8 totale 244.00 senza pagamenti When POST /api/fatture/8/pagamenti importo 244.00 Then HTTP 201 e stato PAGATA [33m 649[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Registrazione pagamento totale[2m > [22mTests AC-1: Given pagamento totale registrato When GET /api/fatture/8 Then residuo 0.00 [33m 338[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-stato-base-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1907[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - RICEVUTA -> IN_DIAGNOSI con storico[2m > [22mTests AC-1: Given userId=7 role TECNICO assigned to riparazione 10 in stato RICEVUTA When PATCH /api/riparazioni/10/stato with {"stato":"IN_DIAGNOSI","note":"Iniziata diagnosi"} Then 200 with data {id:10, stato:IN_DIAGNOSI} [33m 471[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-stato-preventivo-atdd.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2199[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - IN_DIAGNOSI -> PREVENTIVO_EMESSO[2m > [22mTests AC-1: Given riparazione 10 in stato IN_DIAGNOSI and actor TECNICO userId=7 When PATCH /api/riparazioni/10/stato with {"stato":"PREVENTIVO_EMESSO","note":"Preventivo emesso"} Then 200 with data.stato PREVENTIVO_EMESSO [33m 464[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fatture-lista-dettaglio-atdd.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 2225[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Lista fatture paginata[2m > [22mTests AC-1: Given 20 fatture exist When I GET /api/fatture?page=1&limit=10 Then I receive 200 with data array of 10 fatture and meta { page: 1, limit: 10, total: 20 } [33m 1088[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Lista fatture paginata[2m > [22mTests AC-1: Given 20 fatture exist When I GET /api/fatture?page=1&limit=10 Then response keeps deterministic first page boundaries [33m 406[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 9 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-1 - Creazione articolo con giacenza iniziale[2m > [22mTests AC-1: Given ADMIN and full payload When POST /api/articoli Then 201
[31m[1mAssertionError[22m: expected 404 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m48:29[22m[39m
    [90m 46| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m 47| [39m
    [90m 48| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 49| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoEqual[39m(expect[33m.[39m[34many[39m([33mNumber[39m))[33m;[39m
    [90m 50| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-1 - Creazione articolo con giacenza iniziale[2m > [22mTests AC-1: Given successful creation When reading response Then codiceArticolo and giacenza are expected
[31m[1mAssertionError[22m: expected 404 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m58:29[22m[39m
    [90m 56| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m 57| [39m
    [90m 58| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 59| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mcodiceArticolo)[33m.[39m[34mtoBe[39m([32m"LCD-SAMS21"[39m)[33m;[39m
    [90m 60| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mgiacenza)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-2 - Duplicato codice articolo[2m > [22mTests AC-2: Given existing codiceArticolo When POST duplicate Then 409 CODICE_ARTICOLO_EXISTS
[31m[1mAssertionError[22m: expected 404 to be 409 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 409[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m76:29[22m[39m
    [90m 74| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m 75| [39m
    [90m 76| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m409[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 77| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"CODICE_ARTICOLO_EXISTS"[39m)[33m;[39m
    [90m 78| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-2 - Duplicato codice articolo[2m > [22mTests AC-2: Given duplicate create When API rejects Then message is explicit and id is absent
[31m[1mAssertionError[22m: expected 404 to be 409 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 409[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m91:29[22m[39m
    [90m 89| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m 90| [39m
    [90m 91| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m409[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 92| [39m    expect(response.body.error.message).toBe("Codice articolo gia esisâ€¦
    [90m 93| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-3 - Validazione prezzi[2m > [22mTests AC-3: Given prezzoVendita lower than prezzoAcquisto When POST /api/articoli Then 400 VALIDATION_ERROR
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m104:29[22m[39m
    [90m102| [39m      .send(buildArticoloPayload({ prezzoAcquisto: 100, prezzoVendita:â€¦
    [90m103| [39m
    [90m104| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m105| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"VALIDATION_ERROR"[39m)[33m;[39m
    [90m106| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-3 - Validazione prezzi[2m > [22mTests AC-3: Given invalid price relation When validation fails Then field and message are deterministic
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m114:29[22m[39m
    [90m112| [39m      .send(buildArticoloPayload({ prezzoAcquisto: 100, prezzoVendita:â€¦
    [90m113| [39m
    [90m114| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m115| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mfield)[33m.[39m[34mtoBe[39m([32m"prezzoVendita"[39m)[33m;[39m
    [90m116| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mmessage)[33m.[39m[34mtoBe[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-4 - Tecnico non autorizzato[2m > [22mTests AC-4: Given TECNICO When POST /api/articoli Then 403 FORBIDDEN
[31m[1mAssertionError[22m: expected 404 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m129:29[22m[39m
    [90m127| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m128| [39m
    [90m129| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m130| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"FORBIDDEN"[39m)[33m;[39m
    [90m131| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-4 - Tecnico non autorizzato[2m > [22mTests AC-4: Given TECNICO forbidden response When checking payload Then message is Accesso negato
[31m[1mAssertionError[22m: expected 404 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m139:29[22m[39m
    [90m137| [39m      [33m.[39m[34msend[39m([34mbuildArticoloPayload[39m())[33m;[39m
    [90m138| [39m
    [90m139| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m140| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m"Accesso negato"[39m)[33m;[39m
    [90m141| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/articoli-create-atdd.spec.ts[2m > [22mAC-5 - Fornitore inesistente[2m > [22mTests AC-5: Given ADMIN and missing fornitoreId When POST /api/articoli Then 404 FORNITORE_NOT_FOUND
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'code')[39m
[36m [2mâ¯[22m src/__tests__/articoli-create-atdd.spec.ts:[2m152:32[22m[39m
    [90m150| [39m
    [90m151| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m152| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"FORNITORE_NOT_FOUND"[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m153| [39m  })[33m;[39m
    [90m154| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/9]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m27 passed[39m[22m[90m (28)[39m
[2m      Tests [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m252 passed[39m[22m[90m (261)[39m
[2m   Start at [22m 14:43:20
[2m   Duration [22m 5.78s[2m (transform 2.97s, setup 0ms, collect 78.43s, tests 24.79s, environment 8ms, prepare 8.93s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32mâœ“[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 14:43:27
[2m   Duration [22m 590ms[2m (transform 39ms, setup 0ms, collect 59ms, tests 3ms, environment 0ms, prepare 171ms)[22m

