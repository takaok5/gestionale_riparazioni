npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present

npm warn Unknown env config "run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32m?[39m src/__tests__/preventivi-detail-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32m?[39m src/__tests__/preventivi-send-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 105[2mms[22m[39m
 [32m?[39m src/__tests__/fornitori-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 395[2mms[22m[39m
 [32m?[39m src/__tests__/preventivi-response-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 510[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Approvazione preventivo in stato INVIATO[2m > [22mTests AC-1: Given preventivo id=5 in stato INVIATO e riparazione id=10 in stato IN_ATTESA_APPROVAZIONE When PATCH /api/preventivi/5/risposta con { approvato: true } Then HTTP 200 con data.id=5, data.stato=APPROVATO e data.riparazioneStato=APPROVATA [33m 320[2mms[22m[39m
 [32m?[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 506[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Admin modifica ruolo utente[2m > [22mreturns 200 and updates role to COMMERCIALE for user id=2 [33m 315[2mms[22m[39m
 [32m?[39m src/__tests__/preventivi-update-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 527[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Modifica bozza con replace voci e ricalcolo totali[2m > [22mTests AC-1: Given preventivo id=5 in BOZZA When PUT /api/preventivi/5 con una voce MANODOPERA 2x90 Then HTTP 200 con subtotale=180.00 iva=39.60 totale=219.60 [33m 319[2mms[22m[39m
 [32m?[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 540[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Creazione cliente da utente autenticato[2m > [22mshould return 201 for authenticated COMMERCIALE and generate codiceCliente CLI-000001 [33m 332[2mms[22m[39m
 [32m?[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 556[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Admin crea utente con ruolo specifico[2m > [22mreturns 201 and created user fields for valid ADMIN request [33m 320[2mms[22m[39m
 [32m?[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 558[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Admin crea fornitore con codice FOR-000001[2m > [22mreturns 201 with id and codiceFornitore FOR-000001 for first supplier [33m 317[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 570[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Creazione riparazione con stato iniziale RICEVUTA[2m > [22mTests AC-1: Given cliente id=5 exists When POST /api/riparazioni with full payload Then 201 with codiceRiparazione RIP-20260209-0001 and stato RICEVUTA [33m 326[2mms[22m[39m
 [32m?[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 705[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Audit CREATE su Cliente[2m > [22mreturns 201 on POST /api/clienti and exposes created id [33m 349[2mms[22m[39m
 [32m?[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 730[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return 200 with 15 fornitori and meta {page:1,limit:20,total:15,totalPages:1} [33m 549[2mms[22m[39m
 [32m?[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 761[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Dettaglio cliente esistente[2m > [22mTests AC-1: Given cliente id=5 exists When GET /api/clienti/5 Then 200 with full cliente data [33m 381[2mms[22m[39m
 [32m?[39m src/__tests__/preventivi-create-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 928[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Creazione preventivo con totali[2m > [22mTests AC-1: Given esiste una riparazione con id=10 When invio POST /api/preventivi con payload MANODOPERA+RICAMBIO Then viene creato preventivo in stato "BOZZA" con subtotale=200.00, iva=44.00, totale=244.00 e HTTP 201 [33m 530[2mms[22m[39m
 [32m?[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 968[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Lista clienti paginata[2m > [22mtests AC-1: should return 200 with data[10] and meta {page:1,limit:10,total:25,totalPages:3} [33m 665[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-detail-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1060[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then I receive 200 with full riparazione data including cliente { id, nome, telefono, email }, tecnico { id, username }, current stato [33m 519[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-list-filter-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1096[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Lista riparazioni paginata[2m > [22mtests AC-1: Given 30 repairs exist When GET /api/riparazioni?page=1&limit=15 Then returns 200 with 15 rows and meta {page:1,limit:15,total:30,totalPages:2} [33m 766[2mms[22m[39m
 [31m?[39m src/__tests__/fatture-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 1238[2mms[22m[39m
[31m   [31m×[31m AC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo id=5 APPROVATO con totale 244.00 When POST /api/fatture { riparazioneId: 10 } Then HTTP 201 con numeroFattura 2026/0001 e importi 200/44/244[39m[33m 557[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
[31m   [31m×[31m AC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo approvato per riparazione 10 When genero fattura Then risposta include stato EMESSA, riparazioneId=10 e pdfPath non vuoto[39m[32m 136[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
[31m   [31m×[31m AC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given ultima fattura 2026/0015 e riparazione 11 approvata When POST /api/fatture { riparazioneId: 11 } Then numeroFattura 2026/0016[39m[32m 127[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
[31m   [31m×[31m AC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given due emissioni consecutive nello stesso anno When genero fatture Then la numerazione e' crescente e senza duplicati[39m[32m 123[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
[31m   [31m×[31m AC-3 - Nessun preventivo approvato[2m > [22mTests AC-3: Given riparazione id=10 senza preventivo APPROVATO When POST /api/fatture { riparazioneId: 10 } Then HTTP 400 con errore "No approved preventivo found for this riparazione"[39m[32m 75[2mms[22m[39m
[31m     ? expected 404 to be 400 // Object.is equality[39m
[31m   [31m×[31m AC-3 - Nessun preventivo approvato[2m > [22mTests AC-3: Given riparazione senza preventivo approvato When genero fattura Then nessun id fattura viene restituito[39m[32m 73[2mms[22m[39m
[31m     ? expected 404 to be 400 // Object.is equality[39m
[31m   [31m×[31m AC-4 - Fattura gia' esistente[2m > [22mTests AC-4: Given esiste gia fattura per riparazione id=10 When POST /api/fatture { riparazioneId: 10 } Then HTTP 409 con errore "Invoice already exists for this riparazione"[39m[32m 76[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
[31m   [31m×[31m AC-4 - Fattura gia' esistente[2m > [22mTests AC-4: Given prima emissione gia effettuata su riparazione 10 When ripeto POST /api/fatture Then la seconda risposta non restituisce nuova fattura[39m[32m 69[2mms[22m[39m
[31m     ? expected 400 to be 200 // Object.is equality[39m
 [32m?[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1303[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 798[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns user payload with id, username, email and role [33m 445[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-annullamento-admin-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1338[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Admin annulla da IN_LAVORAZIONE con nota[2m > [22mTests AC-1: Given ADMIN userId=1 and riparazione 10 in stato IN_LAVORAZIONE When PATCH /api/riparazioni/10/stato {"stato":"ANNULLATA","note":"Cliente ha ritirato dispositivo"} Then 200 with data.stato ANNULLATA [33m 661[2mms[22m[39m
 [32m?[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1367[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Cambio password con currentPassword corretta[2m > [22mreturns 200 on PUT /api/users/me/password with Password1 -> NewPass2 [33m 334[2mms[22m[39m
   [33m[2m?[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 915[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-assegnazione-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1714[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Assegnazione valida a tecnico[2m > [22mTests AC-1: Given admin and user id=7 role TECNICO When PATCH /api/riparazioni/10/assegna {tecnicoId:7} Then 200 and data.id=10 data.tecnicoId=7 [33m 636[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-stato-base-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1978[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - RICEVUTA -> IN_DIAGNOSI con storico[2m > [22mTests AC-1: Given userId=7 role TECNICO assigned to riparazione 10 in stato RICEVUTA When PATCH /api/riparazioni/10/stato with {"stato":"IN_DIAGNOSI","note":"Iniziata diagnosi"} Then 200 with data {id:10, stato:IN_DIAGNOSI} [33m 629[2mms[22m[39m
 [32m?[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1986[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 791[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - Login Utente valido[2m > [22mreturns user payload with id, username, email, role [33m 446[2mms[22m[39m
   [33m[2m?[22m[39m AC-3 - Account disabilitato[2m > [22mreturns 401 ACCOUNT_DISABLED for mario.disabilitato [33m 375[2mms[22m[39m
   [33m[2m?[22m[39m AC-3 - Account disabilitato[2m > [22mreturns no tokens for disabled account [33m 315[2mms[22m[39m
 [32m?[39m src/__tests__/riparazioni-stato-preventivo-atdd.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2222[2mms[22m[39m
   [33m[2m?[22m[39m AC-1 - IN_DIAGNOSI -> PREVENTIVO_EMESSO[2m > [22mTests AC-1: Given riparazione 10 in stato IN_DIAGNOSI and actor TECNICO userId=7 When PATCH /api/riparazioni/10/stato with {"stato":"PREVENTIVO_EMESSO","note":"Preventivo emesso"} Then 200 with data.stato PREVENTIVO_EMESSO [33m 641[2mms[22m[39m
System.Management.Automation.RemoteException
[31m???????[39m[1m[41m Failed Tests 8 [49m[22m[31m???????[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo id=5 APPROVATO con totale 244.00 When POST /api/fatture { riparazioneId: 10 } Then HTTP 201 con numeroFattura 2026/0001 e importi 200/44/244
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m106:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[1/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo approvato per riparazione 10 When genero fattura Then risposta include stato EMESSA, riparazioneId=10 e pdfPath non vuoto
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m122:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[2/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given ultima fattura 2026/0015 e riparazione 11 approvata When POST /api/fatture { riparazioneId: 11 } Then numeroFattura 2026/0016
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m140:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[3/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given due emissioni consecutive nello stesso anno When genero fatture Then la numerazione e' crescente e senza duplicati
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m161:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[4/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-3 - Nessun preventivo approvato[2m > [22mTests AC-3: Given riparazione id=10 senza preventivo APPROVATO When POST /api/fatture { riparazioneId: 10 } Then HTTP 400 con errore "No approved preventivo found for this riparazione"
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 400[39m
[31m+ 404[39m
System.Management.Automation.RemoteException
[36m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m191:29[22m[39m
    [90m189| [39m      [33m.[39m[34msend[39m({ riparazioneId[33m:[39m [34m10[39m })[33m;[39m
    [90m190| [39m
    [90m191| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m192| [39m    expect(response.body?.error?.message).toBe("No approved preventivo…
    [90m193| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39merror[33m?.[39mcode)[33m.[39m[34mtoBe[39m([32m"NO_APPROVED_PREVENTIVO"[39m)[33m;[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[5/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-3 - Nessun preventivo approvato[2m > [22mTests AC-3: Given riparazione senza preventivo approvato When genero fattura Then nessun id fattura viene restituito
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 400[39m
[31m+ 404[39m
System.Management.Automation.RemoteException
[36m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m204:29[22m[39m
    [90m202| [39m      [33m.[39m[34msend[39m({ riparazioneId[33m:[39m [34m10[39m })[33m;[39m
    [90m203| [39m
    [90m204| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m205| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mid)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m206| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mnumeroFattura)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[6/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-4 - Fattura gia' esistente[2m > [22mTests AC-4: Given esiste gia fattura per riparazione id=10 When POST /api/fatture { riparazioneId: 10 } Then HTTP 409 con errore "Invoice already exists for this riparazione"
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m213:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[7/8]?[22m[39m
System.Management.Automation.RemoteException
[41m[1m FAIL [22m[49m src/__tests__/fatture-create-atdd.spec.ts[2m > [22mAC-4 - Fattura gia' esistente[2m > [22mTests AC-4: Given prima emissione gia effettuata su riparazione 10 When ripeto POST /api/fatture Then la seconda risposta non restituisce nuova fattura
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m
System.Management.Automation.RemoteException
[32m- Expected[39m
[31m+ Received[39m
System.Management.Automation.RemoteException
[32m- 200[39m
[31m+ 400[39m
System.Management.Automation.RemoteException
[36m [2m?[22m createApprovedPreventivo src/__tests__/fatture-create-atdd.spec.ts:[2m84:34[22m[39m
    [90m 82| [39m    [33m.[39m[34msend[39m({ approvato[33m:[39m [35mtrue[39m })[33m;[39m
    [90m 83| [39m
    [90m 84| [39m  [34mexpect[39m(approveResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m 85| [39m  [34mexpect[39m(approveResponse[33m.[39mbody[33m?.[39mdata[33m?.[39mstato)[33m.[39m[34mtoBe[39m([32m"APPROVATO"[39m)[33m;[39m
    [90m 86| [39m
[90m [2m?[22m src/__tests__/fatture-create-atdd.spec.ts:[2m234:5[22m[39m
System.Management.Automation.RemoteException
[31m[2m????????????????????????[8/8]?[22m[39m
System.Management.Automation.RemoteException

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m24 passed[39m[22m[90m (25)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m223 passed[39m[22m[90m (231)[39m
[2m   Start at [22m 11:33:55
[2m   Duration [22m 11.79s[2m (transform 5.75s, setup 0ms, collect 196.70s, tests 23.72s, environment 7ms, prepare 27.15s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run
System.Management.Automation.RemoteException

> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m
System.Management.Automation.RemoteException

> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32m?[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 2[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 11:34:17
[2m   Duration [22m 699ms[2m (transform 52ms, setup 0ms, collect 52ms, tests 2ms, environment 0ms, prepare 186ms)[22m

