
> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present --run

npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32m‚úì[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 112[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 114[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 112[2mms[22m[39m
 [31m‚ùØ[39m src/__tests__/fornitori-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[32m 119[2mms[22m[39m
[31m   [31m√ó[31m AC-1 - Dettaglio fornitore esistente[2m > [22mTests AC-1: Given ADMIN and fornitore id=3 exists When GET /api/fornitori/3 Then 200 with full supplier payload[39m[32m 34[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-1 - Dettaglio fornitore esistente[2m > [22mTests AC-1: Given ADMIN and fornitore id=3 exists When GET /api/fornitori/3 Then payload exposes the required anagrafica fields[39m[32m 8[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - Modifica fornitore[2m > [22mTests AC-2: Given ADMIN and fornitore id=3 exists When PUT /api/fornitori/3 with telefono+categoria Then 200 with updated fields[39m[32m 26[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - Modifica fornitore[2m > [22mTests AC-2: Given update success When GET /api/fornitori/3 Then persisted telefono/categoria are returned[39m[32m 15[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-3 - Lista ordini fornitore[2m > [22mTests AC-3: Given fornitore id=3 has 5 ordini When GET /api/fornitori/3/ordini Then 200 with array length 5[39m[32m 12[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-3 - Lista ordini fornitore[2m > [22mTests AC-3: Given fornitore id=3 has ordini When GET /api/fornitori/3/ordini Then each row has projection {id, numeroOrdine, stato, dataOrdine, totale}[39m[32m 6[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
   [32m‚úì[39m AC-4 - Tecnico non autorizzato a modifica fornitore[2m > [22mTests AC-4: Given TECNICO When PUT /api/fornitori/3 with telefono+categoria Then 403 FORBIDDEN[32m 12[2mms[22m[39m
   [32m‚úì[39m AC-4 - Tecnico non autorizzato a modifica fornitore[2m > [22mTests AC-4: Given TECNICO forbidden on PUT /api/fornitori/3 Then response does not expose supplier data payload[32m 6[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 122[2mms[22m[39m
 [32m‚úì[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 166[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 186[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 197[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 293[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 667[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 388[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 681[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 595[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1156[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 380[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 6 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-1 - Dettaglio fornitore esistente[2m > [22mTests AC-1: Given ADMIN and fornitore id=3 exists When GET /api/fornitori/3 Then 200 with full supplier payload
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m33:29[22m[39m
    [90m 31| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m8101[39m))[33m;[39m
    [90m 32| [39m
    [90m 33| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 34| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mid)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m 35| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mcodiceFornitore)[33m.[39m[34mtoBe[39m([32m"FOR-000003"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-1 - Dettaglio fornitore esistente[2m > [22mTests AC-1: Given ADMIN and fornitore id=3 exists When GET /api/fornitori/3 Then payload exposes the required anagrafica fields
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m43:29[22m[39m
    [90m 41| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m8102[39m))[33m;[39m
    [90m 42| [39m
    [90m 43| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 44| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata)[33m.[39m[34mtoEqual[39m(
    [90m 45| [39m      expect[33m.[39m[34mobjectContaining[39m({

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-2 - Modifica fornitore[2m > [22mTests AC-2: Given ADMIN and fornitore id=3 exists When PUT /api/fornitori/3 with telefono+categoria Then 200 with updated fields
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m69:29[22m[39m
    [90m 67| [39m      [33m.[39m[34msend[39m({ telefono[33m:[39m [32m"0687654321"[39m[33m,[39m categoria[33m:[39m [32m"ALTRO"[39m })[33m;[39m
    [90m 68| [39m
    [90m 69| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 70| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mid)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m 71| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mtelefono)[33m.[39m[34mtoBe[39m([32m"0687654321"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-2 - Modifica fornitore[2m > [22mTests AC-2: Given update success When GET /api/fornitori/3 Then persisted telefono/categoria are returned
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m85:29[22m[39m
    [90m 83| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m8203[39m))[33m;[39m
    [90m 84| [39m
    [90m 85| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 86| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mtelefono)[33m.[39m[34mtoBe[39m([32m"0687654321"[39m)[33m;[39m
    [90m 87| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mcategoria)[33m.[39m[34mtoBe[39m([32m"ALTRO"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-3 - Lista ordini fornitore[2m > [22mTests AC-3: Given fornitore id=3 has 5 ordini When GET /api/fornitori/3/ordini Then 200 with array length 5
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m97:29[22m[39m
    [90m 95| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m8301[39m))[33m;[39m
    [90m 96| [39m
    [90m 97| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 98| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody[33m?.[39mdata))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 99| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata)[33m.[39m[34mtoHaveLength[39m([34m5[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-detail-update-atdd.spec.ts[2m > [22mAC-3 - Lista ordini fornitore[2m > [22mTests AC-3: Given fornitore id=3 has ordini When GET /api/fornitori/3/ordini Then each row has projection {id, numeroOrdine, stato, dataOrdine, totale}
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-detail-update-atdd.spec.ts:[2m107:29[22m[39m
    [90m105| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m8302[39m))[33m;[39m
    [90m106| [39m
    [90m107| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m108| [39m    const rows = (response.body?.data ?? []) as Array<Record<string, u‚Ä¶
    [90m109| [39m    [34mexpect[39m(rows[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m5[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/6]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m11 passed[39m[22m[90m (12)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m105 passed[39m[22m[90m (111)[39m
[2m   Start at [22m 02:41:48
[2m   Duration [22m 3.37s[2m (transform 913ms, setup 0ms, collect 19.32s, tests 3.93s, environment 2ms, prepare 3.55s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32m‚úì[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 02:41:53
[2m   Duration [22m 551ms[2m (transform 46ms, setup 0ms, collect 44ms, tests 3ms, environment 0ms, prepare 196ms)[22m

