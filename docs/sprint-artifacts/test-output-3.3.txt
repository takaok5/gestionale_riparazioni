
> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present --run

npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32mâœ“[39m src/__tests__/fornitori-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 137[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 144[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 148[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 153[2mms[22m[39m
 [32mâœ“[39m src/__tests__/riparazioni-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 171[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 181[2mms[22m[39m
 [32mâœ“[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 224[2mms[22m[39m
 [32mâœ“[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 254[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 272[2mms[22m[39m
 [32mâœ“[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 365[2mms[22m[39m
 [31mâ¯[39m src/__tests__/riparazioni-detail-atdd.spec.ts [2m([22m[2m8 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 431[2mms[22m[39m
[31m   [31mÃ—[31m AC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then I receive 200 with full riparazione data including cliente { id, nome, telefono, email }, tecnico { id, username }, current stato[39m[32m 164[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then response uses data envelope with expected top-level fields[39m[32m 61[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Storico stati della riparazione[2m > [22mTests AC-2: Given riparazione id=10 has changed stato 3 times When I GET /api/riparazioni/10 Then response includes statiHistory array with 3 entries showing { stato, dataOra, userId, note }[39m[32m 52[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Storico stati della riparazione[2m > [22mTests AC-2: Given riparazione id=10 has changed stato 3 times When I GET /api/riparazioni/10 Then each statiHistory entry has ISO dataOra[39m[32m 53[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Preventivi e ricambi nel dettaglio[2m > [22mTests AC-3: Given riparazione id=10 has 2 preventivi and 5 ricambi When I GET /api/riparazioni/10 Then response includes preventivi array and ricambi array with complete details[39m[32m 47[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Preventivi e ricambi nel dettaglio[2m > [22mTests AC-3: Given riparazione id=10 has 2 preventivi and 5 ricambi When I GET /api/riparazioni/10 Then each preventivo/ricambio row exposes required fields[39m[32m 42[2mms[22m[39m
[31m     â†’ expected 404 to be 200 // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Riparazione non trovata[2m > [22mTests AC-4: Given riparazione id=999 does not exist When I GET /api/riparazioni/999 Then I receive 404 with error RIPARAZIONE_NOT_FOUND[39m[32m 5[2mms[22m[39m
[31m     â†’ expected undefined to be 'RIPARAZIONE_NOT_FOUND' // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Riparazione non trovata[2m > [22mTests AC-4: Given riparazione id=999 does not exist When I GET /api/riparazioni/999 Then response does not expose data payload[39m[32m 5[2mms[22m[39m
[31m     â†’ expected undefined to deeply equal ObjectContaining{â€¦}[39m
 [32mâœ“[39m src/__tests__/riparazioni-list-filter-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 435[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 768[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 425[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns user payload with id, username, email and role [33m 319[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 780[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 675[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1275[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 413[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Login Utente valido[2m > [22mreturns user payload with id, username, email, role [33m 315[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 8 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then I receive 200 with full riparazione data including cliente { id, nome, telefono, email }, tecnico { id, username }, current stato
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m78:29[22m[39m
    [90m 76| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9301[39m))[33m;[39m
    [90m 77| [39m
    [90m 78| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 79| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mid)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m 80| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mcliente)[33m.[39m[34mtoEqual[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then response uses data envelope with expected top-level fields
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m104:29[22m[39m
    [90m102| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9302[39m))[33m;[39m
    [90m103| [39m
    [90m104| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m105| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoEqual[39m(
    [90m106| [39m      expect[33m.[39m[34mobjectContaining[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-2 - Storico stati della riparazione[2m > [22mTests AC-2: Given riparazione id=10 has changed stato 3 times When I GET /api/riparazioni/10 Then response includes statiHistory array with 3 entries showing { stato, dataOra, userId, note }
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m129:29[22m[39m
    [90m127| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9401[39m))[33m;[39m
    [90m128| [39m
    [90m129| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m130| [39m    expect(Array.isArray(response.body?.data?.statiHistory)).toBe(trueâ€¦
    [90m131| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mstatiHistory)[33m.[39m[34mtoHaveLength[39m([34m3[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-2 - Storico stati della riparazione[2m > [22mTests AC-2: Given riparazione id=10 has changed stato 3 times When I GET /api/riparazioni/10 Then each statiHistory entry has ISO dataOra
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m154:29[22m[39m
    [90m152| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9402[39m))[33m;[39m
    [90m153| [39m
    [90m154| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m155| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mstatiHistory)[33m.[39m[34mtoHaveLength[39m([34m3[39m)[33m;[39m
    [90m156| [39m    [35mfor[39m ([35mconst[39m row [35mof[39m response[33m.[39mbody[33m?.[39mdata[33m?.[39mstatiHistory [33m??[39m []) {

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-3 - Preventivi e ricambi nel dettaglio[2m > [22mTests AC-3: Given riparazione id=10 has 2 preventivi and 5 ricambi When I GET /api/riparazioni/10 Then response includes preventivi array and ricambi array with complete details
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m170:29[22m[39m
    [90m168| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9501[39m))[33m;[39m
    [90m169| [39m
    [90m170| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m171| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mpreventivi))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m172| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mricambi))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-3 - Preventivi e ricambi nel dettaglio[2m > [22mTests AC-3: Given riparazione id=10 has 2 preventivi and 5 ricambi When I GET /api/riparazioni/10 Then each preventivo/ricambio row exposes required fields
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m184:29[22m[39m
    [90m182| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"TECNICO"[39m[33m,[39m [34m9502[39m))[33m;[39m
    [90m183| [39m
    [90m184| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m185| [39m    [35mfor[39m ([35mconst[39m preventivo [35mof[39m response[33m.[39mbody[33m?.[39mdata[33m?.[39mpreventivi [33m??[39m []) {
    [90m186| [39m      [34mexpect[39m(preventivo)[33m.[39m[34mtoEqual[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-4 - Riparazione non trovata[2m > [22mTests AC-4: Given riparazione id=999 does not exist When I GET /api/riparazioni/999 Then I receive 404 with error RIPARAZIONE_NOT_FOUND
[31m[1mAssertionError[22m: expected undefined to be 'RIPARAZIONE_NOT_FOUND' // Object.is equality[39m

[32m- Expected:[39m 
"RIPARAZIONE_NOT_FOUND"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m217:40[22m[39m
    [90m215| [39m
    [90m216| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m217| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39merror[33m?.[39mcode)[33m.[39m[34mtoBe[39m([32m"RIPARAZIONE_NOT_FOUND"[39m)[33m;[39m
    [90m   | [39m                                       [31m^[39m
    [90m218| [39m    expect(response.body?.error?.message).toBe("Riparazione non trovatâ€¦
    [90m219| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/8]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/riparazioni-detail-atdd.spec.ts[2m > [22mAC-4 - Riparazione non trovata[2m > [22mTests AC-4: Given riparazione id=999 does not exist When I GET /api/riparazioni/999 Then response does not expose data payload
[31m[1mAssertionError[22m: expected undefined to deeply equal ObjectContaining{â€¦}[39m

[32m- Expected:[39m 
ObjectContaining {
  "code": "RIPARAZIONE_NOT_FOUND",
}

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/__tests__/riparazioni-detail-atdd.spec.ts:[2m228:34[22m[39m
    [90m226| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m227| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m228| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39merror)[33m.[39m[34mtoEqual[39m(
    [90m   | [39m                                 [31m^[39m
    [90m229| [39m      expect[33m.[39m[34mobjectContaining[39m({
    [90m230| [39m        code[33m:[39m [32m"RIPARAZIONE_NOT_FOUND"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/8]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (15)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m133 passed[39m[22m[90m (141)[39m
[2m   Start at [22m 18:58:03
[2m   Duration [22m 3.63s[2m (transform 1.30s, setup 0ms, collect 26.16s, tests 5.74s, environment 3ms, prepare 3.84s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32mâœ“[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 18:58:08
[2m   Duration [22m 505ms[2m (transform 35ms, setup 0ms, collect 36ms, tests 3ms, environment 0ms, prepare 137ms)[22m

