
> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present --run

npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32m‚úì[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1143[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Dettaglio cliente esistente[2m > [22mTests AC-1: Given cliente id=5 exists When GET /api/clienti/5 Then 200 with full cliente data [33m 382[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-ricambi-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1165[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Collegamento ricambio con scarico automatico[2m > [22mTests AC-1: Given articolo id=5 has giacenza 15 and prezzoVendita 150.00 When I POST /api/riparazioni/10/ricambi with { articoloId: 5, quantita: 2 } Then 201 and body has articoloId/quantita/prezzoUnitario [33m 383[2mms[22m[39m
 [32m‚úì[39m src/__tests__/articoli-movimenti-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1237[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Movimento CARICO con tracciamento utente e timestamp[2m > [22mTests AC-1: Given articolo giacenza 10 When POST CARICO 20 Then 201 and giacenza 30 [33m 355[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1438[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 732[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns user payload with id, username, email and role [33m 439[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-create-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1494[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Creazione preventivo con totali[2m > [22mTests AC-1: Given esiste una riparazione con id=10 When invio POST /api/preventivi con payload MANODOPERA+RICAMBIO Then viene creato preventivo in stato "BOZZA" con subtotale=200.00, iva=44.00, totale=244.00 e HTTP 201 [33m 599[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Validazione voce senza descrizione[2m > [22mTests AC-4: Given invio POST /api/preventivi con una voce senza descrizione When la richiesta viene validata Then ricevo HTTP 400 con error.code "VALIDATION_ERROR" e messaggio "descrizione is required for each voce" [33m 324[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-etichetta-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1481[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Etichetta PDF 62x100mm con QR e dati riparazione[2m > [22mTests AC-1: Given riparazione id=10 con codiceRiparazione "RIP-20260209-0001", cliente "Rossi Mario", dispositivo "Samsung Galaxy S21" When GET /api/riparazioni/10/etichetta as TECNICO Then 200 with application/pdf and attachment filename [33m 590[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Fallback codiceCliente quando nome cliente assente[2m > [22mTests AC-2: Given riparazione id=10 with cliente.nome empty and codiceCliente CLI-000005 When GET /api/riparazioni/10/etichetta as TECNICO Then PDF customer line shows CLI-000005 [33m 305[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-account-activation-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1649[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Attivazione account portale cliente[2m > [22mTests AC-4: Given token valido non scaduto When POST /api/portal/auth/activate Then 200 con data.clienteId=5 e stato ATTIVO [33m 736[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Attivazione account portale cliente[2m > [22mTests AC-4: Given attivazione riuscita When POST /api/portal/auth/login con nuove credenziali Then 200 con accessToken e refreshToken [33m 911[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1670[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista clienti paginata[2m > [22mtests AC-1: should return 200 with data[10] and meta {page:1,limit:10,total:25,totalPages:3} [33m 897[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista clienti paginata[2m > [22mtests AC-1: should return records ordered by id asc on page 1 [33m 397[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-detail-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1953[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Dettaglio riparazione con cliente, tecnico e stato corrente[2m > [22mTests AC-1: Given riparazione id=10 exists When I GET /api/riparazioni/10 Then I receive 200 with full riparazione data including cliente { id, nome, telefono, email }, tecnico { id, username }, current stato [33m 590[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Storico stati della riparazione[2m > [22mTests AC-2: Given riparazione id=10 has changed stato 3 times When I GET /api/riparazioni/10 Then response includes statiHistory array with 3 entries showing { stato, dataOra, userId, note } [33m 316[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-list-filter-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 2048[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista riparazioni paginata[2m > [22mtests AC-1: Given 30 repairs exist When GET /api/riparazioni?page=1&limit=15 Then returns 200 with 15 rows and meta {page:1,limit:15,total:30,totalPages:2} [33m 1136[2mms[22m[39m
 [32m‚úì[39m src/__tests__/ordini-stato-atdd.spec.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 2134[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - BOZZA -> EMESSO imposta dataEmissione[2m > [22mTests AC-1: Given utente ADMIN e ordine 12 in BOZZA con dataEmissione null When PATCH /api/ordini/12/stato {"stato":"EMESSO"} Then HTTP 200 con stato EMESSO e dataEmissione valorizzata [33m 386[2mms[22m[39m
 [32m‚úì[39m src/__tests__/ordini-ricezione-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2202[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given ordine SPEDITO con due voci e giacenze 3/8 When POST /api/ordini/:id/ricevi completo Then giacenze 13/13 e stato RICEVUTO[2m > [22mTests AC-1: Given ordine id=12 stato SPEDITO con voci articolo 5/7 e giacenze 3/8 When POST /api/ordini/12/ricevi con quantita 10 e 5 Then HTTP 200 e stato RICEVUTO [33m 512[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given ordine con 2 voci When POST /api/ordini/:id/ricevi parziale solo articolo 5 Then solo articolo 5 incrementa e ordine resta SPEDITO[2m > [22mTests AC-2: Given ricezione parziale articoloUno When verifico giacenze Then articoloUno=9 e articoloDue=8 [33m 320[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-ricevuta-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2211[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - PDF A4 ricevuta con sezioni obbligatorie[2m > [22mTests AC-1: Given repair id=10 with full customer/device/intake data When GET /api/riparazioni/10/ricevuta as TECNICO Then 200 with application/pdf and filename ricevuta-riparazione-10.pdf [33m 556[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Accessori consegnati mostrati per elemento[2m > [22mTests AC-2: Given accessoriConsegnati="Caricabatterie, custodia" When GET /api/riparazioni/10/ricevuta Then PDF contains separate rows "- Caricabatterie" and "- custodia" [33m 302[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2274[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 690[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login Utente valido[2m > [22mreturns user payload with id, username, email, role [33m 411[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Account disabilitato[2m > [22mreturns 401 ACCOUNT_DISABLED for mario.disabilitato [33m 447[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Account disabilitato[2m > [22mreturns no tokens for disabled account [33m 458[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fatture-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2592[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo id=5 APPROVATO con totale 244.00 When POST /api/fatture { riparazioneId: 10 } Then HTTP 201 con numeroFattura 2026/0001 e importi 200/44/244 [33m 636[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Creazione fattura da preventivo approvato[2m > [22mTests AC-1: Given preventivo approvato per riparazione 10 When genero fattura Then risposta include stato EMESSA, riparazioneId=10 e pdfPath non vuoto [33m 334[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given ultima fattura 2026/0015 e riparazione 11 approvata When POST /api/fatture { riparazioneId: 11 } Then numeroFattura 2026/0016 [33m 385[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Sequenza numeroFattura[2m > [22mTests AC-2: Given due emissioni consecutive nello stesso anno When genero fatture Then la numerazione e' crescente e senza duplicati [33m 399[2mms[22m[39m
 [32m‚úì[39m src/__tests__/report-magazzino-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2631[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - KPI report magazzino[2m > [22mTests AC-1: Given articoli with giacenze and prezzi When GET /api/report/magazzino Then returns 200 with KPI keys [33m 646[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - KPI report magazzino[2m > [22mTests AC-1: Given Display Samsung S21 with SCARICO 45 When report is returned Then top item includes articoloId=5 and quantitaUtilizzata=45 [33m 362[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Conteggio articoli esauriti[2m > [22mTests AC-2: Given articolo id=5 has giacenza 0 and sogliaMinima>0 When GET /api/report/magazzino Then articoliEsauriti is incremented [33m 393[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Conteggio articoli esauriti[2m > [22mTests AC-2: Given one seeded zero-stock articolo When report is returned Then articoliSottoSoglia is at least articoliEsauriti [33m 319[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-annullamento-admin-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 2686[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Admin annulla da IN_LAVORAZIONE con nota[2m > [22mTests AC-1: Given ADMIN userId=1 and riparazione 10 in stato IN_LAVORAZIONE When PATCH /api/riparazioni/10/stato {"stato":"ANNULLATA","note":"Cliente ha ritirato dispositivo"} Then 200 with data.stato ANNULLATA [33m 812[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Admin annulla da IN_LAVORAZIONE con nota[2m > [22mTests AC-1: Given admin cancellation succeeds When GET /api/riparazioni/10 Then latest statiHistory row has stato ANNULLATA userId 1 note "Cliente ha ritirato dispositivo" [33m 510[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Admin annulla da RICEVUTA senza nota[2m > [22mTests AC-2: Given ADMIN userId=1 and riparazione 10 in stato RICEVUTA When PATCH /api/riparazioni/10/stato {"stato":"ANNULLATA"} Then 200 with data.stato ANNULLATA [33m 417[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Admin annulla da RICEVUTA senza nota[2m > [22mTests AC-2: Given admin cancellation without note succeeds When GET /api/riparazioni/10 Then latest statiHistory row has stato ANNULLATA userId 1 note "" [33m 311[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Tecnico non admin non puo' annullare[2m > [22mTests AC-3: Given cancellation by non-admin tecnico fails When GET /api/riparazioni/10 Then stato remains IN_LAVORAZIONE and history length is unchanged [33m 342[2mms[22m[39m
 [32m‚úì[39m src/__tests__/articoli-list-search-alert-atdd.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 2779[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista paginata articoli[2m > [22mTests AC-1: Given 30 articoli exist When GET /api/articoli?page=1&limit=20 Then 200 with 20 rows and meta [33m 1069[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista paginata articoli[2m > [22mTests AC-1: Given page=2 limit=10 When listing Then meta reflects pagination and deterministic boundaries [33m 731[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-stato-notifiche-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 3117[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - RICEVUTA generates email and INVIATA Notifica[2m > [22mTests AC-1: Given riparazione id=10 and cliente@test.it When PATCH /api/riparazioni/10/stato sets stato=RICEVUTA Then 200 and email subject "Riparazione Ricevuta - RIP-20260209-0001" is returned in payload [33m 730[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - RICEVUTA generates email and INVIATA Notifica[2m > [22mTests AC-1: Given transition to RICEVUTA succeeds When GET /api/notifiche?tipo=STATO_RIPARAZIONE Then latest row has stato INVIATA and riferimentoId 10 [33m 500[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - COMPLETATA sends ready-for-pickup email[2m > [22mTests AC-2: Given riparazione 10 in IN_LAVORAZIONE When PATCH /api/riparazioni/10/stato {"stato":"COMPLETATA"} Then 200 and email subject Riparazione Completata [33m 387[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - COMPLETATA sends ready-for-pickup email[2m > [22mTests AC-2: Given completion transition succeeds When GET /api/notifiche?stato=INVIATA Then notifica body contains "La sua riparazione e pronta per il ritiro" [33m 323[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - CONSEGNATA sends delivery email[2m > [22mTests AC-3: Given consegna succeeds When GET /api/notifiche?tipo=STATO_RIPARAZIONE Then latest notification is INVIATA for riparazione 10 [33m 308[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Email failure keeps status change and stores FALLITA[2m > [22mTests AC-4: Given email service fails When GET /api/notifiche?stato=FALLITA Then latest notification has tipo STATO_RIPARAZIONE and riferimentoId 10 [33m 302[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-assegnazione-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 3831[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Assegnazione valida a tecnico[2m > [22mTests AC-1: Given admin and user id=7 role TECNICO When PATCH /api/riparazioni/10/assegna {tecnicoId:7} Then 200 and data.id=10 data.tecnicoId=7 [33m 785[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Assegnazione valida a tecnico[2m > [22mTests AC-1: Given assignment to tecnico id=7 succeeds When requesting detail Then riparazione 10 has tecnico.id=7 [33m 525[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Rifiuto assegnazione a utente non tecnico[2m > [22mTests AC-2: Given user id=5 role COMMERCIALE When PATCH /api/riparazioni/10/assegna {tecnicoId:5} Then 400 with VALIDATION_ERROR and message [33m 406[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Rifiuto assegnazione a utente non tecnico[2m > [22mTests AC-2: Given assignment to COMMERCIALE fails When requesting detail Then tecnico.id remains 7 [33m 323[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Riassegnazione a un altro tecnico[2m > [22mTests AC-3: Given reassignment to tecnico id=8 succeeds When requesting detail Then tecnico.id is 8 [33m 349[2mms[22m[39m
   [33m[2m‚úì[22m[39m Review hardening - error handling coverage[2m > [22mGiven tecnicoId=999 does not exist When ADMIN patches /api/riparazioni/10/assegna Then returns 404 USER_NOT_FOUND [33m 346[2mms[22m[39m
   [33m[2m‚úì[22m[39m Review hardening - error handling coverage[2m > [22mGiven tecnicoId is not a positive integer When ADMIN patches /api/riparazioni/10/assegna Then returns 400 VALIDATION_ERROR on tecnicoId [33m 377[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-stato-base-atdd.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 4706[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - RICEVUTA -> IN_DIAGNOSI con storico[2m > [22mTests AC-1: Given userId=7 role TECNICO assigned to riparazione 10 in stato RICEVUTA When PATCH /api/riparazioni/10/stato with {"stato":"IN_DIAGNOSI","note":"Iniziata diagnosi"} Then 200 with data {id:10, stato:IN_DIAGNOSI} [33m 780[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - RICEVUTA -> IN_DIAGNOSI con storico[2m > [22mTests AC-1: Given transition to IN_DIAGNOSI succeeds When GET /api/riparazioni/10 Then statiHistory latest row contains stato IN_DIAGNOSI, userId 7, note "Iniziata diagnosi" [33m 517[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - IN_DIAGNOSI -> IN_LAVORAZIONE[2m > [22mTests AC-2: Given riparazione 10 in stato IN_DIAGNOSI and assigned tecnico userId=7 When PATCH /api/riparazioni/10/stato {"stato":"IN_LAVORAZIONE"} Then 200 with data.stato IN_LAVORAZIONE [33m 419[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - IN_DIAGNOSI -> IN_LAVORAZIONE[2m > [22mTests AC-2: Given transition to IN_LAVORAZIONE succeeds When GET /api/riparazioni/10 Then current stato is IN_LAVORAZIONE [33m 337[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - IN_LAVORAZIONE -> COMPLETATA[2m > [22mTests AC-3: Given riparazione 10 in stato IN_LAVORAZIONE and assigned tecnico userId=7 When PATCH /api/riparazioni/10/stato {"stato":"COMPLETATA"} Then 200 with data.stato COMPLETATA [33m 364[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Transizione non valida da RICEVUTA a COMPLETATA[2m > [22mTests AC-5: Given invalid transition request fails When GET /api/riparazioni/10 Then stato remains RICEVUTA and no new history entry is added [33m 333[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-6 - Divieto per tecnico non assegnato[2m > [22mTests AC-6: Given userId=7 role COMMERCIALE (not ADMIN) When PATCH /api/riparazioni/10/stato {"stato":"IN_DIAGNOSI"} Then 403 FORBIDDEN [33m 332[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fatture-pagamenti-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 4823[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Registrazione pagamento totale[2m > [22mTests AC-1: Given fattura id=8 totale 244.00 senza pagamenti When POST /api/fatture/8/pagamenti importo 244.00 Then HTTP 201 e stato PAGATA [33m 1156[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Registrazione pagamento totale[2m > [22mTests AC-1: Given pagamento totale registrato When GET /api/fatture/8 Then residuo 0.00 [33m 731[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Registrazione pagamento parziale + saldo[2m > [22mTests AC-2: Given pagamento iniziale 100.00 When POST saldo 144.00 Then totalePagato 244.00 e stato PAGATA [33m 533[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Registrazione pagamento parziale + saldo[2m > [22mTests AC-2: Given due pagamenti 100+144 When GET /api/fatture/8 Then pagamenti length 2 [33m 484[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Blocco overpayment[2m > [22mTests AC-3: Given fattura gia saldata 244.00 When POST importo 10.00 Then HTTP 400 con messaggio overpayment [33m 430[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Blocco overpayment[2m > [22mTests AC-3: Given overpayment rifiutato When GET /api/fatture/8 Then numero pagamenti resta invariato [33m 582[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Dettaglio fattura con pagamenti[2m > [22mTests AC-4: Given pagamento da 100.00 esiste When GET /api/fatture/8 Then pagamenti include importo 100 e residuo 144 [33m 478[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Dettaglio fattura con pagamenti[2m > [22mTests AC-4: Given pagamento da 100.00 esiste When GET /api/fatture/8 Then prima riga pagamenti ha importo 100.00 [33m 412[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 618[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return 200 with 15 fornitori and meta {page:1,limit:20,total:15,totalPages:1} [33m 374[2mms[22m[39m
 [32m‚úì[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 568[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 366[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 422[2mms[22m[39m
 [32m‚úì[39m src/__tests__/riparazioni-stato-preventivo-atdd.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 5538[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - IN_DIAGNOSI -> PREVENTIVO_EMESSO[2m > [22mTests AC-1: Given riparazione 10 in stato IN_DIAGNOSI and actor TECNICO userId=7 When PATCH /api/riparazioni/10/stato with {"stato":"PREVENTIVO_EMESSO","note":"Preventivo emesso"} Then 200 with data.stato PREVENTIVO_EMESSO [33m 742[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - IN_DIAGNOSI -> PREVENTIVO_EMESSO[2m > [22mTests AC-1: Given transition to PREVENTIVO_EMESSO succeeds When GET /api/riparazioni/10 Then latest statiHistory row contains stato PREVENTIVO_EMESSO, userId 7 and note "Preventivo emesso" [33m 543[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - PREVENTIVO_EMESSO -> IN_ATTESA_APPROVAZIONE[2m > [22mTests AC-2: Given riparazione 10 in stato PREVENTIVO_EMESSO and actor TECNICO userId=7 When PATCH /api/riparazioni/10/stato with {"stato":"IN_ATTESA_APPROVAZIONE","note":"In attesa approvazione preventivo"} Then 200 with data.stato IN_ATTESA_APPROVAZIONE [33m 405[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - PREVENTIVO_EMESSO -> IN_ATTESA_APPROVAZIONE[2m > [22mTests AC-2: Given transition to IN_ATTESA_APPROVAZIONE succeeds When GET /api/riparazioni/10 Then latest statiHistory row contains stato IN_ATTESA_APPROVAZIONE, userId 7 and note "In attesa approvazione preventivo" [33m 322[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - IN_ATTESA_APPROVAZIONE -> APPROVATA[2m > [22mTests AC-3: Given transition to APPROVATA succeeds When GET /api/riparazioni/10 Then latest statiHistory row contains stato APPROVATA, userId 7 and note "Preventivo approvato" [33m 345[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - IN_ATTESA_APPROVAZIONE -> ANNULLATA[2m > [22mTests AC-4: Given transition to ANNULLATA succeeds When GET /api/riparazioni/10 Then latest statiHistory row contains stato ANNULLATA, userId 1 and note "Preventivo annullato dal cliente" [33m 305[2mms[22m[39m
 [32m‚úì[39m src/__tests__/stripe-pagamenti-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 5629[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Link Stripe Checkout[2m > [22mTests AC-1: Given fattura id=8 totale 244.00 stato EMESSA When POST /api/pagamenti/crea-link/8 Then HTTP 200 con paymentUrl e sessionId [33m 1156[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Link Stripe Checkout[2m > [22mTests AC-1: Given richiesta link Stripe valida When POST /api/pagamenti/crea-link/8 Then paymentUrl ha prefisso Stripe e sessionId segue pattern cs_ [33m 713[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Fattura gia pagata[2m > [22mTests AC-2: Given fattura id=8 stato PAGATA When POST /api/pagamenti/crea-link/8 Then HTTP 400 con errore Invoice is already paid [33m 537[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Fattura gia pagata[2m > [22mTests AC-2: Given fattura pagata When POST /api/pagamenti/crea-link/8 Then response non contiene paymentUrl/sessionId [33m 481[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Webhook checkout.session.completed[2m > [22mTests AC-3: Given evento checkout.session.completed con metadata.fatturaId=8 When POST /api/webhooks/stripe Then HTTP 200 [33m 469[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Webhook checkout.session.completed[2m > [22mTests AC-3: Given webhook completato When GET /api/fatture/8 Then stato PAGATA e pagamento STRIPE con dataPagamento 2025-02-13 [33m 613[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Firma webhook invalida[2m > [22mTests AC-4: Given stripe-signature invalida When POST /api/webhooks/stripe Then HTTP 400 Invalid signature [33m 376[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Firma webhook invalida[2m > [22mTests AC-4: Given firma invalida When POST /api/webhooks/stripe Then nessun pagamento viene creato su fattura 8 [33m 456[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Idempotenza evento duplicato[2m > [22mTests AC-5: Given pagamento gia registrato per sessionId cs_test_link_8 When POST evento duplicato Then HTTP 200 [33m 418[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Idempotenza evento duplicato[2m > [22mTests AC-5: Given evento duplicato stripe su sessionId gia processato When POST /api/webhooks/stripe Then pagamenti.length resta 1 [33m 405[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-notifiche-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 421[2mms[22m[39m
 [32m‚úì[39m src/__tests__/notifiche-list-atdd.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 240[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 1436[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 1013[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 322[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fatture-lista-dettaglio-atdd.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 6310[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista fatture paginata[2m > [22mTests AC-1: Given 20 fatture exist When I GET /api/fatture?page=1&limit=10 Then I receive 200 with data array of 10 fatture and meta { page: 1, limit: 10, total: 20 } [33m 2072[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Lista fatture paginata[2m > [22mTests AC-1: Given 20 fatture exist When I GET /api/fatture?page=1&limit=10 Then response keeps deterministic first page boundaries [33m 1036[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Filtro stato PAGATA[2m > [22mTests AC-2: Given fatture with stato EMESSA and PAGATA exist When I GET /api/fatture?stato=PAGATA Then I receive only fatture with stato PAGATA [33m 329[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Filtro range date[2m > [22mTests AC-3: Given fatture created in February 2026 exist When I GET /api/fatture?dataDa=2026-02-01&dataA=2026-02-28 Then I receive fatture within that date range [33m 436[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Filtro range date[2m > [22mTests AC-3: Given fatture created in February 2026 exist When I GET /api/fatture?dataDa=2026-02-01&dataA=2026-02-28 Then each row has date in requested range [33m 429[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Dettaglio fattura con due pagamenti[2m > [22mTests AC-4: Given fattura id=8 has 2 pagamenti When I GET /api/fatture/8 Then I receive fattura details with pagamenti array showing both payments [33m 444[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Dettaglio fattura con due pagamenti[2m > [22mTests AC-4: Given fattura id=8 has 2 pagamenti When I GET /api/fatture/8 Then each payment row exposes id/importo/metodo/dataPagamento [33m 463[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Download PDF fattura[2m > [22mTests AC-5: Given fattura id=8 has generated PDF When I GET /api/fatture/8/pdf Then I receive PDF file with content-type application/pdf and correct filename [33m 575[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Download PDF fattura[2m > [22mTests AC-5: Given fattura id=8 has generated PDF When I GET /api/fatture/8/pdf Then filename includes normalized numeroFattura [33m 332[2mms[22m[39m
 [32m‚úì[39m src/__tests__/articoli-create-atdd.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 469[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 244[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-dashboard-me.atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 6513[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Dashboard counters for customer[2m > [22mTests AC-1: Given customer id=5 has 2 open orders, 1 active repair, and 1 pending quote When GET /api/portal/me with valid token Then 200 with exact stats [33m 1184[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Dashboard counters for customer[2m > [22mTests AC-1: Given same customer scenario When GET /api/portal/me Then stats keys are present and numeric [33m 973[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Zero counters are numeric and never null[2m > [22mTests AC-2: Given customer has no active items When GET /api/portal/me Then returns zero counters [33m 1080[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Zero counters are numeric and never null[2m > [22mTests AC-2: Given customer has no active items When GET /api/portal/me Then counters are not null [33m 1152[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Recent events are sorted by descending timestamp[2m > [22mTests AC-3: Given customer has recent status/invoice events When GET /api/portal/me Then response has eventiRecenti array [33m 1071[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Recent events are sorted by descending timestamp[2m > [22mTests AC-3: Given customer has recent events When GET /api/portal/me Then each event has required keys and descending timestamps [33m 1033[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 334[2mms[22m[39m
 [32m‚úì[39m src/__tests__/report-riparazioni-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 382[2mms[22m[39m
 [32m‚úì[39m src/__tests__/ordini-create-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 223[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-send-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 125[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-update-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 233[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-response-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 165[2mms[22m[39m
 [32m‚úì[39m src/__tests__/dashboard-riparazioni-per-stato-atdd.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 163[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fornitori-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 156[2mms[22m[39m
 [32m‚úì[39m src/__tests__/dashboard-carico-tecnici-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 170[2mms[22m[39m
 [32m‚úì[39m src/__tests__/report-export-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 118[2mms[22m[39m
 [32m‚úì[39m src/__tests__/report-finanziari-atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 82[2mms[22m[39m
 [32m‚úì[39m src/__tests__/dashboard-operativa-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 100[2mms[22m[39m
 [31m‚ùØ[39m src/__tests__/public-contacts-faq-api.atdd.spec.ts [2m([22m[2m8 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 94[2mms[22m[39m
[31m   [31m√ó[31m AC-1 - GET /api/public/pages/contatti[2m > [22mTests AC-1: Given public contact config contains phone=+39 02 1234 5678, email=info@centrotest.it, openingHours=Lun-Ven 09:00-18:30; Sab 09:00-13:00, and mapPlaceholder=MAP_EMBED_PENDING When an anonymous visitor requests GET /api/public/pages/contatti Then API returns HTTP 200 and data payload with contatti fields[39m[32m 37[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-1 - GET /api/public/pages/contatti[2m > [22mTests AC-1: Given same endpoint response When contact fields are inspected Then phone/email/openingHours/mapPlaceholder match exact configured literals[39m[32m 10[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - GET /api/public/faq[2m > [22mTests AC-2: Given FAQ public data contains categories Accettazione and Preventivi with configured entries When an anonymous visitor requests GET /api/public/faq Then API returns HTTP 200 with grouped FAQ rows[39m[32m 8[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - GET /api/public/faq[2m > [22mTests AC-2: Given FAQ endpoint response When searching entry Il preventivo e gratuito? Then exact configured answer Si, salvo guasti non standard is returned[39m[32m 6[2mms[22m[39m
[31m     ‚Üí Cannot read properties of undefined (reading 'find')[39m
[31m   [31m√ó[31m AC-3 - Public config refresh without frontend code changes[2m > [22mTests AC-3: Given config phone is updated to +39 02 7654 3210 and endpoints expose updated payload When an anonymous visitor requests GET /api/public/pages/contatti after refresh Then response includes updated phone[39m[32m 9[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-3 - Public config refresh without frontend code changes[2m > [22mTests AC-3: Given FAQ answer Il preventivo e gratuito? is updated to Si, sempre and endpoint exposes updated payload When an anonymous visitor requests GET /api/public/faq after refresh Then updated answer is returned[39m[32m 7[2mms[22m[39m
[31m     ‚Üí Cannot read properties of undefined (reading 'find')[39m
[31m   [31m√ó[31m AC-5 - Sad path unsupported page slug[2m > [22mTests AC-5: Given an anonymous visitor requests GET /api/public/pages/slug-non-supportato When backend handles /api/public/pages/:slug with unsupported slug Then API responds HTTP 404 with error.code PAGE_NOT_FOUND[39m[32m 7[2mms[22m[39m
[31m     ‚Üí expected undefined to be 'PAGE_NOT_FOUND' // Object.is equality[39m
[31m   [31m√ó[31m AC-5 - Sad path unsupported page slug[2m > [22mTests AC-5: Given unsupported slug request When API returns 404 Then deterministic error payload contains error.message and no data field[39m[32m 8[2mms[22m[39m
[31m     ‚Üí expected {} to have property "error"[39m
 [32m‚úì[39m src/__tests__/portal-account-conflict-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 99[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-preventivi-risposta.atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 8544[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given preventivo id=5 belongs to my repair and stato is INVIATO When I POST /api/portal/preventivi/5/risposta with { approvato: true } Then preventivo becomes APPROVATO, riparazione becomes APPROVATA, I receive 200[2m > [22mTests AC-1: returns 200 and APPROVATO/APPROVATA payload [33m 1216[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given preventivo id=5 belongs to my repair and stato is INVIATO When I POST /api/portal/preventivi/5/risposta with { approvato: true } Then preventivo becomes APPROVATO, riparazione becomes APPROVATA, I receive 200[2m > [22mTests AC-1: keeps response contract with ISO dataRisposta [33m 1024[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given preventivo id=5 belongs to my repair and stato is INVIATO When I POST /api/portal/preventivi/5/risposta with { approvato: false } Then preventivo becomes RIFIUTATO, riparazione becomes ANNULLATA, I receive 200[2m > [22mTests AC-2: returns 200 and RIFIUTATO/ANNULLATA payload [33m 1336[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given preventivo id=5 belongs to my repair and stato is INVIATO When I POST /api/portal/preventivi/5/risposta with { approvato: false } Then preventivo becomes RIFIUTATO, riparazione becomes ANNULLATA, I receive 200[2m > [22mTests AC-2: keeps preventivo detail aligned after rejection [33m 1121[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given preventivo id=5 already has stato APPROVATO When I POST /api/portal/preventivi/5/risposta Then I receive 400 with error RESPONSE_ALREADY_RECORDED[2m > [22mTests AC-3: returns 400 with RESPONSE_ALREADY_RECORDED [33m 1096[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given preventivo id=5 already has stato APPROVATO When I POST /api/portal/preventivi/5/risposta Then I receive 400 with error RESPONSE_ALREADY_RECORDED[2m > [22mTests AC-3: keeps payload without success data on duplicate response [33m 1048[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given preventivo id=5 belongs to another customer When I POST /api/portal/preventivi/5/risposta Then I receive 403 FORBIDDEN[2m > [22mTests AC-4: returns 403 FORBIDDEN when customer does not own preventivo [33m 945[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given preventivo id=5 belongs to another customer When I POST /api/portal/preventivi/5/risposta Then I receive 403 FORBIDDEN[2m > [22mTests AC-4: does not expose success payload fields on forbidden response [33m 754[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-account-email-required-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 45[2mms[22m[39m
 [32m‚úì[39m src/__tests__/preventivi-detail-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 51[2mms[22m[39m
 [32m‚úì[39m src/__tests__/public-services-api.atdd.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 105[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-account-create-atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 83[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-riparazioni-list-detail.atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 9369[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given customer id=5 has 3 repairs When GET /api/portal/riparazioni Then 200 with status + basic device details[2m > [22mTests AC-1: Given customer id=5 has exactly 3 repairs When list endpoint is requested Then returns HTTP 200 with 3 rows [33m 1232[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given customer id=5 has 3 repairs When GET /api/portal/riparazioni Then 200 with status + basic device details[2m > [22mTests AC-1: Given list payload is returned When reading row fields Then each row has stato, tipoDispositivo, marcaDispositivo, modelloDispositivo [33m 1135[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given repairs in IN_DIAGNOSI and COMPLETATA exist When GET /api/portal/riparazioni?stato=IN_DIAGNOSI Then only diagnostics-phase repairs[2m > [22mTests AC-2: Given mixed states When stato filter IN_DIAGNOSI is applied Then every row has stato IN_DIAGNOSI [33m 1312[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given repairs in IN_DIAGNOSI and COMPLETATA exist When GET /api/portal/riparazioni?stato=IN_DIAGNOSI Then only diagnostics-phase repairs[2m > [22mTests AC-2: Given filtered list response When checking meta Then filtered total is coherent and COMPLETATA is excluded [33m 1095[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given repair id=10 belongs to authenticated customer When GET /api/portal/riparazioni/10 Then full detail with timeline and linked document ids[2m > [22mTests AC-3: Given repair id=10 belongs to customer 5 When detail endpoint is requested Then returns 200 with id=10 and arrays timeline/documentiCollegati [33m 1110[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given repair id=10 belongs to authenticated customer When GET /api/portal/riparazioni/10 Then full detail with timeline and linked document ids[2m > [22mTests AC-3: Given detail payload is returned When validating object shape Then timeline and linked documents expose required keys [33m 1138[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given repair id=10 does not belong to authenticated customer When GET /api/portal/riparazioni/10 Then 403 FORBIDDEN[2m > [22mTests AC-4: Given repair id=10 belongs to customer 5 When customer 99 requests detail Then returns HTTP 403 with FORBIDDEN code [33m 956[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given repair id=10 does not belong to authenticated customer When GET /api/portal/riparazioni/10 Then 403 FORBIDDEN[2m > [22mTests AC-4: Given forbidden detail request When response is returned Then no detail payload is exposed [33m 793[2mms[22m[39m
   [33m[2m‚úì[22m[39m Hardening - Auth and validation[2m > [22mreturns 400 when riparazione id is not a positive integer [33m 591[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-ordini-list-detail.atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 9376[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given customer id=5 has 12 orders When GET /api/portal/ordini?page=1&limit=10 Then 10 items + pagination metadata[2m > [22mTests AC-1: Given customer id=5 has 12 orders When GET /api/portal/ordini?page=1&limit=10 Then HTTP 200 and exactly 10 items [33m 1526[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given customer id=5 has 12 orders When GET /api/portal/ordini?page=1&limit=10 Then 10 items + pagination metadata[2m > [22mTests AC-1: Given same scenario When first page is requested Then response includes deterministic pagination keys [33m 1361[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given orders with states IN_ATTESA and IN_LAVORAZIONE exist When GET /api/portal/ordini?stato=IN_LAVORAZIONE Then only IN_LAVORAZIONE[2m > [22mTests AC-2: Given mixed states When filtered by IN_LAVORAZIONE Then every returned item has that state [33m 1281[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given orders with states IN_ATTESA and IN_LAVORAZIONE exist When GET /api/portal/ordini?stato=IN_LAVORAZIONE Then only IN_LAVORAZIONE[2m > [22mTests AC-2: Given IN_ATTESA and IN_LAVORAZIONE exist When stato filter applied Then non matching states are excluded [33m 1099[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given order id=20 belongs to authenticated customer When GET /api/portal/ordini/20 Then detail with stato/importi/timeline/documenti[2m > [22mTests AC-3: Given order id=20 belongs to authenticated customer When detail is requested Then HTTP 200 with required fields [33m 1410[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given order id=20 belongs to authenticated customer When GET /api/portal/ordini/20 Then detail with stato/importi/timeline/documenti[2m > [22mTests AC-3: Given order id=20 belongs to authenticated customer When detail is requested Then timeline/documenti structures are arrays [33m 1093[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given order id=20 belongs to another customer When GET /api/portal/ordini/20 Then 403 FORBIDDEN[2m > [22mTests AC-4: Given order id=20 belongs to customer 5 When customer 99 requests it Then HTTP 403 with FORBIDDEN [33m 873[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Given order id=20 belongs to another customer When GET /api/portal/ordini/20 Then 403 FORBIDDEN[2m > [22mTests AC-4: Given forbidden detail request When customer 99 calls order 20 Then no detail payload is leaked [33m 730[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-documenti-download.atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 9597[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given fattura id=8 belongs to authenticated customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive application/pdf with correct filename[2m > [22mTests AC-1: Given fattura id=8 belongs to authenticated customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive 200 with pdf headers [33m 2111[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Given fattura id=8 belongs to authenticated customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive application/pdf with correct filename[2m > [22mTests AC-1: Given fattura id=8 belongs to authenticated customer When I GET /api/portal/documenti/fattura/8/pdf Then filename matches normalized invoice pattern [33m 1593[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given quote id=5 belongs to authenticated customer When I GET /api/portal/documenti/preventivo/5/pdf Then I receive application/pdf with correct filename[2m > [22mTests AC-2: Given quote id=5 belongs to authenticated customer When I GET /api/portal/documenti/preventivo/5/pdf Then I receive 200 with pdf headers [33m 1057[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Given quote id=5 belongs to authenticated customer When I GET /api/portal/documenti/preventivo/5/pdf Then I receive application/pdf with correct filename[2m > [22mTests AC-2: Given quote id=5 belongs to authenticated customer When I GET /api/portal/documenti/preventivo/5/pdf Then filename equals preventivo-{id}.pdf [33m 1084[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given requested document id belongs to another customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive 403 FORBIDDEN[2m > [22mTests AC-3: Given requested document id belongs to another customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive 403 with FORBIDDEN code [33m 1336[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Given requested document id belongs to another customer When I GET /api/portal/documenti/fattura/8/pdf Then I receive 403 FORBIDDEN[2m > [22mTests AC-3: Given requested document id belongs to another customer When I GET /api/portal/documenti/fattura/8/pdf Then no PDF content is returned [33m 1068[2mms[22m[39m
   [33m[2m‚úì[22m[39m Hardening - Portal document download contracts[2m > [22mreturns 400 VALIDATION_ERROR when document id is not a positive integer [33m 749[2mms[22m[39m
   [33m[2m‚úì[22m[39m Hardening - Portal document download contracts[2m > [22mreturns 403 FORBIDDEN when preventivo belongs to another customer [33m 586[2mms[22m[39m
 [32m‚úì[39m src/__tests__/portal-auth-login-refresh-logout.atdd.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 15028[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login portale con credenziali valide[2m > [22mreturns 200 with accessToken and refreshToken [33m 1090[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login portale con credenziali valide[2m > [22mreturns customer profileSummary with expected identifiers [33m 960[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Login portale con password non valida[2m > [22mreturns 401 with error code INVALID_CREDENTIALS [33m 1097[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Login portale con password non valida[2m > [22mdoes not return accessToken and refreshToken [33m 1164[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Lock temporaneo account portale[2m > [22mreturns 423 ACCOUNT_TEMPORARILY_LOCKED on attempt after threshold [33m 4891[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-3 - Lock temporaneo account portale[2m > [22mreturns Retry-After header and no tokens while account is locked [33m 2841[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Refresh token portale[2m > [22mreturns 200 with new accessToken and refreshToken [33m 531[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-4 - Refresh token portale[2m > [22minvalidates old refresh token after successful rotation [33m 598[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Logout portale con revoca refresh token[2m > [22mreturns 200 with data.revoked=true [33m 542[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Logout portale con revoca refresh token[2m > [22mreturns 401 on refresh with revoked token after logout [33m 509[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-5 - Logout portale con revoca refresh token[2m > [22mreturns 401 when logout access token header is invalid [33m 508[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 8 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-1 - GET /api/public/pages/contatti[2m > [22mTests AC-1: Given public contact config contains phone=+39 02 1234 5678, email=info@centrotest.it, openingHours=Lun-Ven 09:00-18:30; Sab 09:00-13:00, and mapPlaceholder=MAP_EMBED_PENDING When an anonymous visitor requests GET /api/public/pages/contatti Then API returns HTTP 200 and data payload with contatti fields
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m9:29[22m[39m
    [90m  7| [39m    const response = await request(app).get("/api/public/pages/contatt‚Ä¶
    [90m  8| [39m
    [90m  9| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 10| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"data"[39m)[33m;[39m
    [90m 11| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m"phone"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-1 - GET /api/public/pages/contatti[2m > [22mTests AC-1: Given same endpoint response When contact fields are inspected Then phone/email/openingHours/mapPlaceholder match exact configured literals
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m20:29[22m[39m
    [90m 18| [39m    const response = await request(app).get("/api/public/pages/contatt‚Ä¶
    [90m 19| [39m
    [90m 20| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 21| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mphone)[33m.[39m[34mtoBe[39m([32m"+39 02 1234 5678"[39m)[33m;[39m
    [90m 22| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39memail)[33m.[39m[34mtoBe[39m([32m"info@centrotest.it"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-2 - GET /api/public/faq[2m > [22mTests AC-2: Given FAQ public data contains categories Accettazione and Preventivi with configured entries When an anonymous visitor requests GET /api/public/faq Then API returns HTTP 200 with grouped FAQ rows
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m33:29[22m[39m
    [90m 31| [39m    const rows = response.body?.data as Array<{ category?: string; que‚Ä¶
    [90m 32| [39m
    [90m 33| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 34| [39m    [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(rows))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 35| [39m    [34mexpect[39m(rows[33m.[39mlength)[33m.[39m[34mtoBeGreaterThanOrEqual[39m([34m2[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-2 - GET /api/public/faq[2m > [22mTests AC-2: Given FAQ endpoint response When searching entry Il preventivo e gratuito? Then exact configured answer Si, salvo guasti non standard is returned
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m43:25[22m[39m
    [90m 41| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)[33m.[39m[35mget[39m([32m"/api/public/faq"[39m)[33m;[39m
    [90m 42| [39m    const rows = response.body?.data as Array<{ question?: string; ans‚Ä¶
    [90m 43| [39m    const target = rows.find((row) => row.question === "Il preventivo ‚Ä¶
    [90m   | [39m                        [31m^[39m
    [90m 44| [39m
    [90m 45| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-3 - Public config refresh without frontend code changes[2m > [22mTests AC-3: Given config phone is updated to +39 02 7654 3210 and endpoints expose updated payload When an anonymous visitor requests GET /api/public/pages/contatti after refresh Then response includes updated phone
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m55:29[22m[39m
    [90m 53| [39m    const response = await request(app).get("/api/public/pages/contatt‚Ä¶
    [90m 54| [39m
    [90m 55| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 56| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata[33m?.[39mphone)[33m.[39m[34mtoBe[39m([32m"+39 02 7654 3210"[39m)[33m;[39m
    [90m 57| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-3 - Public config refresh without frontend code changes[2m > [22mTests AC-3: Given FAQ answer Il preventivo e gratuito? is updated to Si, sempre and endpoint exposes updated payload When an anonymous visitor requests GET /api/public/faq after refresh Then updated answer is returned
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m62:25[22m[39m
    [90m 60| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)[33m.[39m[35mget[39m([32m"/api/public/faq"[39m)[33m;[39m
    [90m 61| [39m    const rows = response.body?.data as Array<{ question?: string; ans‚Ä¶
    [90m 62| [39m    const target = rows.find((row) => row.question === "Il preventivo ‚Ä¶
    [90m   | [39m                        [31m^[39m
    [90m 63| [39m
    [90m 64| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-5 - Sad path unsupported page slug[2m > [22mTests AC-5: Given an anonymous visitor requests GET /api/public/pages/slug-non-supportato When backend handles /api/public/pages/:slug with unsupported slug Then API responds HTTP 404 with error.code PAGE_NOT_FOUND
[31m[1mAssertionError[22m: expected undefined to be 'PAGE_NOT_FOUND' // Object.is equality[39m

[32m- Expected:[39m 
"PAGE_NOT_FOUND"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m74:40[22m[39m
    [90m 72| [39m
    [90m 73| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m 74| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39merror[33m?.[39mcode)[33m.[39m[34mtoBe[39m([32m"PAGE_NOT_FOUND"[39m)[33m;[39m
    [90m   | [39m                                       [31m^[39m
    [90m 75| [39m  })[33m;[39m
    [90m 76| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contacts-faq-api.atdd.spec.ts[2m > [22mAC-5 - Sad path unsupported page slug[2m > [22mTests AC-5: Given unsupported slug request When API returns 404 Then deterministic error payload contains error.message and no data field
[31m[1mAssertionError[22m: expected {} to have property "error"[39m
[36m [2m‚ùØ[22m src/__tests__/public-contacts-faq-api.atdd.spec.ts:[2m81:27[22m[39m
    [90m 79| [39m
    [90m 80| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m404[39m)[33m;[39m
    [90m 81| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 82| [39m    [34mexpect[39m([35mtypeof[39m response[33m.[39mbody[33m?.[39merror[33m?.[39mmessage)[33m.[39m[34mtoBe[39m([32m"string"[39m)[33m;[39m
    [90m 83| [39m    [34mexpect[39m(response[33m.[39mbody[33m?.[39mdata)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/8]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m58 passed[39m[22m[90m (59)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m507 passed[39m[22m[90m (515)[39m
[2m   Start at [22m 00:20:38
[2m   Duration [22m 30.73s[2m (transform 5.95s, setup 0ms, collect 519.45s, tests 135.00s, environment 16ms, prepare 40.87s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

 [32m‚úì[39m src/__tests__/public-services-detail.atdd.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32m‚úì[39m src/__tests__/public-home-vetrina.atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [31m‚ùØ[39m src/__tests__/public-contatti-faq-pages.atdd.spec.ts [2m([22m[2m6 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[32m 24[2mms[22m[39m
[31m   [31m√ó[31m AC-1 - Pagina /contatti[2m > [22mTests AC-1: Given public contact config has phone/email/openingHours/mapPlaceholder When an anonymous visitor opens /contatti Then markup contains clickable tel/mailto and exact opening hours[39m[32m 13[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'tel:+390212345678'[39m
[31m   [31m√ó[31m AC-1 - Pagina /contatti[2m > [22mTests AC-1: Given /contatti markup When map section is inspected Then placeholder text Mappa in aggiornamento is visible[39m[32m 3[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Mappa in aggiornamento'[39m
[31m   [31m√ó[31m AC-2 - Pagina /faq[2m > [22mTests AC-2: Given FAQ public data contains categories Accettazione and Preventivi When an anonymous visitor opens /faq Then page shows both category headers and question labels[39m[32m 1[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Accettazione'[39m
[31m   [31m√ó[31m AC-2 - Pagina /faq[2m > [22mTests AC-2: Given /faq page When question Il preventivo e gratuito? is expanded Then exact answer Si, salvo guasti non standard is present[39m[32m 2[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Si, salvo guasti non standard'[39m
[31m   [31m√ó[31m AC-4 - Navigazione / -> /faq -> /[2m > [22mTests AC-4: Given visitor reaches /faq from home link FAQ When FAQ page renders Then breadcrumb Home / FAQ and title FAQ are shown[39m[32m 1[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Home / FAQ'[39m
[31m   [31m√ó[31m AC-4 - Navigazione / -> /faq -> /[2m > [22mTests AC-4: Given FAQ page has breadcrumb Home When visitor uses breadcrumb to return Then link to / exists and home title remains Riparazioni rapide e trasparenti[39m[32m 2[2mms[22m[39m
[31m     ‚Üí expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'href="/"'[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 6 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-1 - Pagina /contatti[2m > [22mTests AC-1: Given public contact config has phone/email/openingHours/mapPlaceholder When an anonymous visitor opens /contatti Then markup contains clickable tel/mailto and exact opening hours
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'tel:+390212345678'[39m

Expected: [32m"tel:+390212345678"[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m14:18[22m[39m
    [90m 12| [39m    [35mconst[39m html [33m=[39m [34mrenderPath[39m([32m"/contatti"[39m)[33m;[39m
    [90m 13| [39m
    [90m 14| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"tel:+390212345678"[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 15| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"mailto:info@centrotest.it"[39m)[33m;[39m
    [90m 16| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Lun-Ven 09:00-18:30; Sab 09:00-13:00"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-1 - Pagina /contatti[2m > [22mTests AC-1: Given /contatti markup When map section is inspected Then placeholder text Mappa in aggiornamento is visible
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Mappa in aggiornamento'[39m

Expected: [32m"Mappa in aggiornamento"[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m22:18[22m[39m
    [90m 20| [39m    [35mconst[39m html [33m=[39m [34mrenderPath[39m([32m"/contatti"[39m)[33m;[39m
    [90m 21| [39m
    [90m 22| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Mappa in aggiornamento"[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 23| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Contatti"[39m)[33m;[39m
    [90m 24| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-2 - Pagina /faq[2m > [22mTests AC-2: Given FAQ public data contains categories Accettazione and Preventivi When an anonymous visitor opens /faq Then page shows both category headers and question labels
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Accettazione'[39m

Expected: [32m"Accettazione"[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m31:18[22m[39m
    [90m 29| [39m    [35mconst[39m html [33m=[39m [34mrenderPath[39m([32m"/faq"[39m)[33m;[39m
    [90m 30| [39m
    [90m 31| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Accettazione"[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 32| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Preventivi"[39m)[33m;[39m
    [90m 33| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Quanto dura una diagnosi?"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-2 - Pagina /faq[2m > [22mTests AC-2: Given /faq page When question Il preventivo e gratuito? is expanded Then exact answer Si, salvo guasti non standard is present
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Si, salvo guasti non standard'[39m

Expected: [32m"Si, salvo guasti non standard"[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m40:18[22m[39m
    [90m 38| [39m    [35mconst[39m html [33m=[39m [34mrenderPath[39m([32m"/faq"[39m)[33m;[39m
    [90m 39| [39m
    [90m 40| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Si, salvo guasti non standard"[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 41| [39m  })[33m;[39m
    [90m 42| [39m})[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-4 - Navigazione / -> /faq -> /[2m > [22mTests AC-4: Given visitor reaches /faq from home link FAQ When FAQ page renders Then breadcrumb Home / FAQ and title FAQ are shown
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'Home / FAQ'[39m

Expected: [32m"Home / FAQ"[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m48:18[22m[39m
    [90m 46| [39m    [35mconst[39m html [33m=[39m [34mrenderPath[39m([32m"/faq"[39m)[33m;[39m
    [90m 47| [39m
    [90m 48| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m"Home / FAQ"[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 49| [39m    [34mexpect[39m(html)[33m.[39m[34mtoContain[39m([32m">FAQ<"[39m)[33m;[39m
    [90m 50| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/6]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/public-contatti-faq-pages.atdd.spec.ts[2m > [22mAC-4 - Navigazione / -> /faq -> /[2m > [22mTests AC-4: Given FAQ page has breadcrumb Home When visitor uses breadcrumb to return Then link to / exists and home title remains Riparazioni rapide e trasparenti
[31m[1mAssertionError[22m: expected '<div class="min-h-screen overflow-x-h‚Ä¶' to contain 'href="/"'[39m

Expected: [32m"href="/""[39m
Received: [31m"<div class="min-h-screen overflow-x-hidden bg-slate-50 text-slate-900"><header class="border-b border-slate-200 bg-white/90 backdrop-blur"><div class="mx-auto max-w-screen-xl max-w-screen px-4 py-4 sm:px-6 lg:px-8"><p class="text-sm font-semibold uppercase tracking-wide text-slate-500">Gestionale Riparazioni</p></div></header><main class="mx-auto max-w-screen-xl max-w-screen px-4 py-10 sm:px-6 lg:px-8"><section class="grid gap-8 rounded-3xl bg-white p-6 shadow-sm ring-1 ring-slate-100 lg:grid-cols-[2fr_1fr] lg:p-10"><div><p class="inline-flex rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-emerald-700">Assistenza certificata</p><h1 class="mt-4 text-3xl font-bold leading-tight sm:text-4xl">Riparazioni rapide e trasparenti</h1><p class="mt-4 text-base text-slate-600 sm:text-lg">Gestiamo diagnosi, riparazioni e aggiornamenti con tempi chiari e preventivi leggibili prima di ogni intervento.</p><div class="mt-7 flex flex-wrap gap-3"><a href="/richiedi-preventivo" class="inline-flex items-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-slate-700">Richiedi preventivo</a><a href="/portale/login" class="inline-flex items-center rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800 transition hover:border-slate-500">Accedi al portale cliente</a></div></div><aside class="rounded-2xl bg-slate-100 p-5"><p class="text-xs font-semibold uppercase tracking-wide text-slate-500">Impegno tempi medi</p><p class="mt-3 text-sm text-slate-700">85% delle riparazioni chiuse entro 48 ore con aggiornamenti stato notificati in tempo reale.</p></aside></section><section class="mt-12"><h2 class="text-2xl font-semibold">Servizi in evidenza</h2><div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Diagnosi smartphone e tablet</h3><p class="mt-2 text-sm text-slate-600">Check completo hardware/software con report chiaro dei guasti.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 29 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>24-48 ore</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Sostituzione display e batterie</h3><p class="mt-2 text-sm text-slate-600">Ricambi selezionati con collaudo finale e controllo funzionale completo.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 59 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>1-2 giorni</dd></div></dl></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recupero dati e messa in sicurezza</h3><p class="mt-2 text-sm text-slate-600">Backup assistito, recupero da dispositivi danneggiati e protezione account.</p><dl class="mt-4 space-y-1 text-sm text-slate-700"><div><dt class="font-medium">prezzo indicativo</dt><dd>da 79 EUR</dd></div><div><dt class="font-medium">tempo medio</dt><dd>2-3 giorni</dd></div></dl></article></div></section><section class="mt-12"><h2 class="text-2xl font-semibold">Perche sceglierci</h2><div class="mt-5 grid gap-4 sm:grid-cols-3"><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Recensioni</h3><p class="mt-2 text-sm text-slate-600">Valutazione media 4.8/5 con feedback verificati da clienti reali.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">FAQ</h3><p class="mt-2 text-sm text-slate-600">Risposte rapide su tempi, garanzia e processo di presa in carico.</p></article><article class="rounded-2xl bg-white p-5 shadow-sm ring-1 ring-slate-100"><h3 class="text-lg font-semibold">Contatti</h3><p class="mt-2 text-sm text-slate-600">Telefono, email e orari aggiornati per richiedere supporto immediato.</p></article></div></section></main></div>"[39m

[36m [2m‚ùØ[22m src/__tests__/public-contatti-faq-pages.atdd.spec.ts:[2m56:21[22m[39m
    [90m 54| [39m    [35mconst[39m homeHtml [33m=[39m [34mrenderPath[39m([32m"/"[39m)[33m;[39m
    [90m 55| [39m
    [90m 56| [39m    [34mexpect[39m(faqHtml)[33m.[39m[34mtoContain[39m([32m'href="/"'[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m 57| [39m    [34mexpect[39m(homeHtml)[33m.[39m[34mtoContain[39m([32m"Riparazioni rapide e trasparenti"[39m)[33m;[39m
    [90m 58| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/6]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (3)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 00:21:18
[2m   Duration [22m 974ms[2m (transform 196ms, setup 0ms, collect 945ms, tests 41ms, environment 0ms, prepare 556ms)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\frontend
npm error workspace @gestionale/frontend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\frontend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32m‚úì[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 00:21:19
[2m   Duration [22m 599ms[2m (transform 37ms, setup 0ms, collect 74ms, tests 3ms, environment 0ms, prepare 168ms)[22m

