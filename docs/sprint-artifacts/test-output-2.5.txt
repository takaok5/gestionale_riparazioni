
> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present --run

npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32m‚úì[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 86[2mms[22m[39m
 [32m‚úì[39m src/__tests__/fornitori-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 87[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 90[2mms[22m[39m
 [31m‚ùØ[39m src/__tests__/fornitori-list-search-atdd.spec.ts [2m([22m[2m8 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 92[2mms[22m[39m
[31m   [31m√ó[31m AC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return 200 with 15 fornitori and meta {page:1,limit:20,total:15,totalPages:1}[39m[32m 27[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return fornitori ordered by id asc[39m[32m 5[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - Filtro categoria fornitori[2m > [22mtests AC-2: should return only categoria=RICAMBI when filter categoria=RICAMBI[39m[32m 24[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-2 - Filtro categoria fornitori[2m > [22mtests AC-2: should exclude categoria=SERVIZI from categoria=RICAMBI results[39m[32m 5[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-3 - Ricerca fornitori su nome o codiceFornitore[2m > [22mtests AC-3: should return only entries matching SRL in nome/codiceFornitore[39m[32m 19[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-3 - Ricerca fornitori su nome o codiceFornitore[2m > [22mtests AC-3: should exclude non-matching suppliers from search=SRL[39m[32m 4[2mms[22m[39m
[31m     ‚Üí expected 404 to be 200 // Object.is equality[39m
[31m   [31m√ó[31m AC-4 - Sad path limite invalido[2m > [22mtests AC-4: should return 400 VALIDATION_ERROR for limit=1000[39m[32m 4[2mms[22m[39m
[31m     ‚Üí expected 404 to be 400 // Object.is equality[39m
[31m   [31m√ó[31m AC-4 - Sad path limite invalido[2m > [22mtests AC-4: should report too_large rule for limit above max[39m[32m 4[2mms[22m[39m
[31m     ‚Üí expected 404 to be 400 // Object.is equality[39m
 [32m‚úì[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 100[2mms[22m[39m
 [32m‚úì[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 139[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-detail-update-atdd.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 161[2mms[22m[39m
 [32m‚úì[39m src/__tests__/clienti-list-search-atdd.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 223[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 657[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 373[2mms[22m[39m
 [32m‚úì[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 665[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 592[2mms[22m[39m
 [32m‚úì[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1155[2mms[22m[39m
   [33m[2m‚úì[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 359[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 8 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return 200 with 15 fornitori and meta {page:1,limit:20,total:15,totalPages:1}
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m getCurrentFornitoriTotal src/__tests__/fornitori-list-search-atdd.spec.ts:[2m49:27[22m[39m
    [90m 47| [39m    [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m userId))[33m;[39m
    [90m 48| [39m
    [90m 49| [39m  [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 50| [39m  [35mreturn[39m [33mNumber[39m(response[33m.[39mbody[33m?.[39mmeta[33m?.[39mtotal [33m??[39m [34m0[39m)[33m;[39m
    [90m 51| [39m}
[90m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m61:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-1 - Lista fornitori paginata[2m > [22mtests AC-1: should return fornitori ordered by id asc
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m88:29[22m[39m
    [90m 86| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m6203[39m))[33m;[39m
    [90m 87| [39m
    [90m 88| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 89| [39m    expect(response.body.data[0].id).toBeLessThan(response.body.data[1‚Ä¶
    [90m 90| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-2 - Filtro categoria fornitori[2m > [22mtests AC-2: should return only categoria=RICAMBI when filter categoria=RICAMBI
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m118:29[22m[39m
    [90m116| [39m    const rows = (response.body.data ?? []) as Array<{ categoria?: str‚Ä¶
    [90m117| [39m
    [90m118| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m119| [39m    [34mexpect[39m(rows[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m120| [39m    expect(rows.every((row) => row.categoria === "RICAMBI")).toBe(true‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-2 - Filtro categoria fornitori[2m > [22mtests AC-2: should exclude categoria=SERVIZI from categoria=RICAMBI results
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m130:29[22m[39m
    [90m128| [39m    const rows = (response.body.data ?? []) as Array<{ categoria?: str‚Ä¶
    [90m129| [39m
    [90m130| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m131| [39m    expect(rows.some((row) => row.categoria === "SERVIZI")).toBe(false‚Ä¶
    [90m132| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-3 - Ricerca fornitori su nome o codiceFornitore[2m > [22mtests AC-3: should return only entries matching SRL in nome/codiceFornitore
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m168:29[22m[39m
    [90m166| [39m    }[33m>[39m[33m;[39m
    [90m167| [39m
    [90m168| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m169| [39m    [34mexpect[39m(rows[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m170| [39m    [34mexpect[39m(

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-3 - Ricerca fornitori su nome o codiceFornitore[2m > [22mtests AC-3: should exclude non-matching suppliers from search=SRL
[31m[1mAssertionError[22m: expected 404 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m186:29[22m[39m
    [90m184| [39m    const rows = (response.body.data ?? []) as Array<{ nome?: string }‚Ä¶
    [90m185| [39m
    [90m186| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m187| [39m    expect(rows.some((row) => (row.nome ?? "").toLowerCase().includes(‚Ä¶
    [90m188| [39m    expect(rows.some((row) => (row.nome ?? "").toLowerCase().includes(‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-4 - Sad path limite invalido[2m > [22mtests AC-4: should return 400 VALIDATION_ERROR for limit=1000
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m198:29[22m[39m
    [90m196| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m6208[39m))[33m;[39m
    [90m197| [39m
    [90m198| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m199| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"VALIDATION_ERROR"[39m)[33m;[39m
    [90m200| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mfield)[33m.[39m[34mtoBe[39m([32m"limit"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/8]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/fornitori-list-search-atdd.spec.ts[2m > [22mAC-4 - Sad path limite invalido[2m > [22mtests AC-4: should report too_large rule for limit above max
[31m[1mAssertionError[22m: expected 404 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 404[39m

[36m [2m‚ùØ[22m src/__tests__/fornitori-list-search-atdd.spec.ts:[2m208:29[22m[39m
    [90m206| [39m      [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [34mauthHeader[39m([32m"ADMIN"[39m[33m,[39m [34m6209[39m))[33m;[39m
    [90m207| [39m
    [90m208| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m209| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mfield)[33m.[39m[34mtoBe[39m([32m"limit"[39m)[33m;[39m
    [90m210| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mrule)[33m.[39m[34mtoBe[39m([32m"too_large"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/8]‚éØ[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (11)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m95 passed[39m[22m[90m (103)[39m
[2m   Start at [22m 23:53:10
[2m   Duration [22m 3.29s[2m (transform 855ms, setup 0ms, collect 16.69s, tests 3.46s, environment 2ms, prepare 3.08s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

 [32m‚úì[39m src/validators/index.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 3[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m4 passed[39m[22m[90m (4)[39m
[2m   Start at [22m 23:53:15
[2m   Duration [22m 542ms[2m (transform 36ms, setup 0ms, collect 38ms, tests 3ms, environment 0ms, prepare 180ms)[22m

