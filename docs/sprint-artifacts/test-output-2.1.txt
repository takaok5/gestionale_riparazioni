npm warn Unknown cli config "--run". This will stop working in the next major version of npm.

> gestionale-riparazioni@0.1.0 test
> npm run test --workspaces --if-present

npm warn Unknown env config "run". This will stop working in the next major version of npm.

> @gestionale/backend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/backend[39m

 [32mâœ“[39m src/__tests__/audit-trail.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 67[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-update-deactivate.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 69[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-create.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 85[2mms[22m[39m
 [31mâ¯[39m src/__tests__/clienti-create-atdd.spec.ts [2m([22m[2m10 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 88[2mms[22m[39m
[31m   [31mÃ—[31m AC-1 - Creazione cliente da utente autenticato[2m > [22mshould return 201 for authenticated COMMERCIALE and generate codiceCliente CLI-000001[39m[32m 41[2mms[22m[39m
[31m     â†’ expected 403 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-1 - Creazione cliente da utente autenticato[2m > [22mshould persist payload business fields on creation[39m[32m 5[2mms[22m[39m
[31m     â†’ expected 403 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Validazione partita IVA su cliente AZIENDA[2m > [22mshould accept 11-digit partitaIva and create AZIENDA with 201[39m[32m 5[2mms[22m[39m
[31m     â†’ expected 400 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-2 - Validazione partita IVA su cliente AZIENDA[2m > [22mshould reject invalid partitaIva format with 400[39m[32m 5[2mms[22m[39m
[31m     â†’ expected 'codiceCliente' to be 'partitaIva' // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Codice fiscale invalido[2m > [22mshould return 400 with Invalid fiscal code format[39m[32m 4[2mms[22m[39m
[31m     â†’ expected 'Payload non valido' to be 'Invalid fiscal code format' // Object.is equality[39m
[31m   [31mÃ—[31m AC-3 - Codice fiscale invalido[2m > [22mshould report validation details for codiceFiscale field[39m[32m 4[2mms[22m[39m
[31m     â†’ expected 'codiceCliente' to be 'codiceFiscale' // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Email duplicata[2m > [22mshould return 409 when creating a second customer with duplicate email[39m[32m 6[2mms[22m[39m
[31m     â†’ expected 400 to be 409 // Object.is equality[39m
[31m   [31mÃ—[31m AC-4 - Email duplicata[2m > [22mshould keep first customer and reject duplicate without creating new id[39m[32m 7[2mms[22m[39m
[31m     â†’ expected 400 to be 201 // Object.is equality[39m
[31m   [31mÃ—[31m AC-5 - Validazione CAP/Provincia[2m > [22mshould reject invalid provincia ZZ with 400 invalid_provincia[39m[32m 5[2mms[22m[39m
[31m     â†’ expected 'required' to be 'invalid_provincia' // Object.is equality[39m
   [32mâœ“[39m AC-5 - Validazione CAP/Provincia[2m > [22mshould reject non-numeric cap with 400 invalid_cap[32m 3[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-refresh.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 670[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Rinnovo con refresh token valido[2m > [22mreturns 200 with new accessToken and refreshToken [33m 357[2mms[22m[39m
 [32mâœ“[39m src/__tests__/users-change-password.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 671[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-2 - Current password errata[2m > [22mkeeps old password valid when change fails [33m 602[2mms[22m[39m
 [32mâœ“[39m src/__tests__/auth-login.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1194[2mms[22m[39m
   [33m[2mâœ“[22m[39m AC-1 - Login Utente valido[2m > [22mreturns 200 with accessToken and refreshToken when credentials are valid [33m 346[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 9 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-1 - Creazione cliente da utente autenticato[2m > [22mshould return 201 for authenticated COMMERCIALE and generate codiceCliente CLI-000001
[31m[1mAssertionError[22m: expected 403 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 403[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m44:29[22m[39m
    [90m 42| [39m      })[33m;[39m
    [90m 43| [39m
    [90m 44| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 45| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoEqual[39m(expect[33m.[39m[34many[39m([33mNumber[39m))[33m;[39m
    [90m 46| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mcodiceCliente)[33m.[39m[34mtoBe[39m([32m"CLI-000001"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-1 - Creazione cliente da utente autenticato[2m > [22mshould persist payload business fields on creation
[31m[1mAssertionError[22m: expected 403 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 403[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m65:29[22m[39m
    [90m 63| [39m      })[33m;[39m
    [90m 64| [39m
    [90m 65| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 66| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mnome)[33m.[39m[34mtoBe[39m([32m"Rossi Mario"[39m)[33m;[39m
    [90m 67| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39memail)[33m.[39m[34mtoBe[39m([32m"mario@test.it"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-2 - Validazione partita IVA su cliente AZIENDA[2m > [22mshould accept 11-digit partitaIva and create AZIENDA with 201
[31m[1mAssertionError[22m: expected 400 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 400[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m87:29[22m[39m
    [90m 85| [39m      })[33m;[39m
    [90m 86| [39m
    [90m 87| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 88| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mtipologia)[33m.[39m[34mtoBe[39m([32m"AZIENDA"[39m)[33m;[39m
    [90m 89| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39mpartitaIva)[33m.[39m[34mtoBe[39m([32m"12345678901"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-2 - Validazione partita IVA su cliente AZIENDA[2m > [22mshould reject invalid partitaIva format with 400
[31m[1mAssertionError[22m: expected 'codiceCliente' to be 'partitaIva' // Object.is equality[39m

Expected: [32m"partitaIva"[39m
Received: [31m"codiceCliente"[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m109:47[22m[39m
    [90m107| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m108| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"VALIDATION_ERROR"[39m)[33m;[39m
    [90m109| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mfield)[33m.[39m[34mtoBe[39m([32m"partitaIva"[39m)[33m;[39m
    [90m   | [39m                                              [31m^[39m
    [90m110| [39m  })[33m;[39m
    [90m111| [39m})[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-3 - Codice fiscale invalido[2m > [22mshould return 400 with Invalid fiscal code format
[31m[1mAssertionError[22m: expected 'Payload non valido' to be 'Invalid fiscal code format' // Object.is equality[39m

Expected: [32m"Invalid fiscal code format"[39m
Received: [31m"Payload non valido"[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m131:41[22m[39m
    [90m129| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m130| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"VALIDATION_ERROR"[39m)[33m;[39m
    [90m131| [39m    expect(response.body.error.message).toBe("Invalid fiscal code formâ€¦
    [90m   | [39m                                        [31m^[39m
    [90m132| [39m  })[33m;[39m
    [90m133| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-3 - Codice fiscale invalido[2m > [22mshould report validation details for codiceFiscale field
[31m[1mAssertionError[22m: expected 'codiceCliente' to be 'codiceFiscale' // Object.is equality[39m

Expected: [32m"codice[7mFiscal[27me"[39m
Received: [31m"codice[7mClient[27me"[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m150:47[22m[39m
    [90m148| [39m
    [90m149| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m150| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mfield)[33m.[39m[34mtoBe[39m([32m"codiceFiscale"[39m)[33m;[39m
    [90m   | [39m                                              [31m^[39m
    [90m151| [39m    expect(response.body.error.details.rule).toBe("invalid_fiscal_codeâ€¦
    [90m152| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-4 - Email duplicata[2m > [22mshould return 409 when creating a second customer with duplicate email
[31m[1mAssertionError[22m: expected 400 to be 409 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 409[39m
[31m+ 400[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m185:35[22m[39m
    [90m183| [39m      })[33m;[39m
    [90m184| [39m
    [90m185| [39m    [34mexpect[39m(secondResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m409[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m186| [39m    expect(secondResponse.body.error.code).toBe("EMAIL_ALREADY_EXISTS"â€¦
    [90m187| [39m    expect(secondResponse.body.error.message).toBe("Email gia esistentâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-4 - Email duplicata[2m > [22mshould keep first customer and reject duplicate without creating new id
[31m[1mAssertionError[22m: expected 400 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 400[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m219:34[22m[39m
    [90m217| [39m      })[33m;[39m
    [90m218| [39m
    [90m219| [39m    [34mexpect[39m(firstResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m220| [39m    [34mexpect[39m(secondResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m409[39m)[33m;[39m
    [90m221| [39m    [34mexpect[39m(secondResponse[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/9]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/clienti-create-atdd.spec.ts[2m > [22mAC-5 - Validazione CAP/Provincia[2m > [22mshould reject invalid provincia ZZ with 400 invalid_provincia
[31m[1mAssertionError[22m: expected 'required' to be 'invalid_provincia' // Object.is equality[39m

Expected: [32m"invalid_provincia"[39m
Received: [31m"required"[39m

[36m [2mâ¯[22m src/__tests__/clienti-create-atdd.spec.ts:[2m243:46[22m[39m
    [90m241| [39m    [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m242| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mcode)[33m.[39m[34mtoBe[39m([32m"VALIDATION_ERROR"[39m)[33m;[39m
    [90m243| [39m    [34mexpect[39m(response[33m.[39mbody[33m.[39merror[33m.[39mdetails[33m.[39mrule)[33m.[39m[34mtoBe[39m([32m"invalid_provincia"[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m244| [39m  })[33m;[39m
    [90m245| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/9]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (7)[39m
[2m      Tests [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m54 passed[39m[22m[90m (63)[39m
[2m   Start at [22m 19:18:49
[2m   Duration [22m 3.17s[2m (transform 566ms, setup 0ms, collect 9.21s, tests 2.84s, environment 2ms, prepare 1.78s)[22m

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error workspace @gestionale/backend@0.1.0
npm error location C:\Users\FAT-E\progetti\gestionale_riparazioni-main\packages\backend
npm error command failed
npm error command C:\WINDOWS\system32\cmd.exe /d /s /c vitest run


> @gestionale/frontend@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/frontend[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m


> @gestionale/shared@0.1.0 test
> vitest run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/FAT-E/progetti/gestionale_riparazioni-main/packages/shared[39m

No test files found, exiting with code 0

[2minclude: [22m[33msrc/**/*.test.ts[2m, [22msrc/**/*.spec.ts[39m
[2mexclude:  [22m[33m**/node_modules/**[2m, [22m**/dist/**[2m, [22m**/cypress/**[2m, [22m**/.{idea,git,cache,output,temp}/**[2m, [22m**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build,eslint,prettier}.config.*[39m

